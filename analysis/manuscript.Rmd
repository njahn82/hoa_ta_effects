---
output:
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    template: apa6.sty
    extra_dependencies: ["flafter"]
csl: apa.csl
bibliography: references.bib
---



```{r, setup, echo=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  fig.width = 6,
  fig.asp = 0.618,
  out.width = "99%",
  fig.align = "center",
  dpi = 300,
  dev = c("png", "pdf"),
  fig.path = "fig/",
  fig.pos = "ht!", out.extra = ""
)
options(scipen = 999, digits = 2)
knitr::knit_hooks$set(
  inline = function(x) {
    if (is.numeric(x)) {
      return(prettyNum(x, big.mark = ","))
    } else{
      return(x)
    }
  }
)
```

```{r dependencies}
library(tidyverse, warn.conflicts = FALSE)
library(kableExtra)
library(patchwork)
```

```{r data, cache=TRUE}
library(hoaddata)

ta_oa_inst <- readr::read_csv(here::here("data", "ta_oa_inst.csv.gz"))

```

# Introduction

For over two decades, hybrid open access journal publishing, which makes some articles openly available while others remain behind a paywall, has been discussed as a means for transitioning the subscription system to full open access [@Prosser_2003].
The idea was that when journals increasingly publish open access articles, they could reduce revenues from subscriptions, while libraries and funders could change their funding models and shift expenditures from subscription to open access. 
However, initial approaches, mainly based on publication fees, also called article processing charges (APCs), did not contribute substantially to a large open access uptake. 
In 2009, the publisher Springer reported that 1% of its articles in hybrid journals were open access [@Dallmeier_2010].
Other studies have also recorded low uptake.
In 2011, only 1-2% of articles were open access [@Bj_rk_2012], increasing to around 4% between 2011 and 2013 [@Laakso_2016]. 

With the introduction of central funding mechanisms for publication fees in some European countries since 2012, an substantial increase in hybrid open access has been observed [@Bj_rk_2017; @Piwowar_2018; @Jubb_2017; @Huang_2020].
For example, studying university output, @Robinson_Garcia_2020 estimated a median uptake of 7.1% in the period 2014-2017. 
In particular, British (17%), Austrian (15%) and Dutch (13%) universities stood out. 
However, this shift in funding policy towards hybrid open access also added to the overall cost of publishing, which includes subscription spending and the administrative efforts required to handle payments [@Pinfield_2016].
Moreover, large commercial publishers, which already dominated the publishing market [@Larivi_re_2015], disproportionately benefited from hybrid open access funding in comparison to full open access publishers [@Jahn_2016; @Butler_2023; @Shu_2023].

As a consequence, libraries and their consortia began to develop licensing strategies aimed at avoiding such ‘double dipping’ scenarios, in which well-established commercial publishers gain twice from reading and open access publishing fees [@Mittermaier_2015], as well as to increase publisher-provided immediate open access [@BJ_RK_2014; @Schimmer_2015].
These considerations resulted in transformative agreements[^agreements], which cover a broad range of contracts between library consortia and publishers from the mid-2010s onwards, where institutional spending for subscriptions and open access publishing are considered together [@Borrego_2020; @Hinchliffe_2019].
Transformative agreements seek to control costs while allowing a transitional phase for publishing more open access articles. 
Similar to big deals, transformative agreements mainly bundle hybrid and subscription-only journals from commercial publishers, but aim at a higher degree of transparency than previous big deals, where contracts including payments were confidential [@Bergstrom_2014].
<!-- For example, the nationwide DEAL consortium in Germany, which includes universities and academic institutions, collectively cancelled their subscriptions with Elsevier from 2017 onwards to negotiate a transformative agreement [@Fraser_2023]. -->

The introduction of transformative agreements aligns with funding policy changes, such as the decision made by cOAlition S, a consortium of funders and research organisations including the European Commission, to no longer provide financial support for individual publication fees when publishing in hybrid journals.
According to its Plan S launched in 2018, cOAlition S members only accept hybrid open access through transformative agreements "during a transition period that should be as short as possible" [@Schiltz_2018]. 
Specifically, they agreed to support hybrid open access only through transformative agreements from 2021, until the end of 2024.
Notably, despite not being part of cOAlition S, the German Research Foundation (DFG), has also extended its financial support for hybrid open access through transformative agreements [@Mittermaier_2021]. Previously, the DFG only provided funding for fully open access journals [@Jahn_2016].

By the end of 2023, many transformative agreements had been implemented, but the interim outcomes were mixed.
The ESAC Transformative Agreement Registry[^esacregistry], the largest resource for library consortia to voluntarily and publicly share their agreements, recorded more than 800 transformative agreements.
These agreements resulted in the publication of up to 900.000 open access articles published in both fully open access and hybrid journals, according to the accompanying ESAC Market Watch[^esacmarketwatch]. 
Library consortia reported increased open access volume, streamlined payment and monitoring procedures, as well as extensive utilisation of open access options by the researchers they serve [@Marques_2020; @Pinhasi_2020; @Parmhed_2023]. 
The ongoing standardisation of transformative agreements has contributed to improved transparency in terms of contracts and publisher-provided article metadata [@Marques_2019; @Pinhasi_2021].
However, with the growing trend toward transformative agreements, continued reliance on big deals is perceived as problematic, because it perpetuates market concentration [@Butler_2023; @Shu_2023]. 
Whether transformative agreements lead to reduced pricing remains uncertain [@Borrego_2023] and
a substantial transition of hybrid journals towards full open access could not be observed [@Momeni_2021; @Matthias_2019].
The focus on large commercial publishers might also increase inequality [@Ross_Hellauer_2022], because transformative agreements' focus on pay to publish mainly targets institutions from high-income countries, furthering a questionable journal prestige culture [@budapest]. 
Besides, an editorial-board resignation raised concerns that transformative agreements might encourage publishers to maximize journal publication volume "without regard to quality" [@Goodin_2023].

The controversies surrounding hybrid open access and transformative agreements have led to varying policy conclusions. 
For instance, the British Joint Information Systems Committee (JISC) evaluated its open access strategy, which included transformative agreements [@Jisc_2024]. 
The evaluation revealed that while these agreements had a significant impact on the growth of open access in the country, they had limited effects in facilitating a global shift towards full open access. 
As a result, the report advised that the British open access strategy should be reassessed.
After making similar observation, Norwegian and Swedish universities and their consortia also argued for policy changes [@norway; @Widding_2024].
Furthermore, cOAlition S conclude its financial support of transformative agreements at the end of 2024, but continue to view open access resulting from such agreements as compliant. [^coalitions].
cOAlition S also removed the majority of hybrid journals from its Transformative Journal program in 2023 due to publishers' failure to meet self-defined open access growth targets [@Brainard_2023]. 
By contrast, the German DEAL consortium announced a five-year transformative agreement with Elsevier starting in 2024 and also renewed its contracts with Springer Nature and Wiley until the end of 2028. Similarly, the Colombia Consortium signed the first transformative agreements in Latin America [@Mu_oz_V_lez_2024].

Despite these controversies around transformative agreements as a means of transitioning journal publishing to full open access, there is limited evidence available on the uptake of open access in hybrid journals, and the extent to which this can be attributed to transformative agreements.
Previous studies have focused on specific countries [@P_l_nen_2020; @Huang_2020; @Haucap_2021; @Wenaas_2022; @ludo_waltman_2022_7105355; @Taubert_2023; @Jisc_2024] or publisher portfolios [@Pieper_2018; @Bakker_2024; @Fraser_2023; @Jahn_2021; @Momeni_2023; @Schmal_2024], while large-scale studies relied on self-reported agreement data [@Moskovkin_2022], or used APC pricing lists [@Shu_2023]. 
In particular, data availability is a limiting factor when studying the impact of transformative agreements [@Bakker_2024], because bibliometric databases, even though many allow the retrieval of open access articles in hybrid journals, do not directly attribute them to specific transformative agreements. 
Likewise, article-level open access invoicing and cost data, which would make it possible to establish a direct link between transformative agreements and open access publications [@Jahn_2021; @Kramer_2024].

The present study aims to address these limitations by combining multiple openly available data sources to determine open access uptake in hybrid journals, while distinguishing between open access through transformative agreements and other means. 
With this novel and open approach, this first large-scale analysis will answer the following questions:

- What was the number and proportion of open access articles in hybrid journals in transformative agreements between 2018 and 2022?
- To what extent did institutions with a transformation agreement contribute to open access in hybrid journals?

For both research questions, this study will analyse the variability by publisher, journal subject, and country.

# Methods

This study combines data from multiple publicly available sources, as shown in Figure \ref{fig:data_workflow}. 
Initially, transformative agreement data retrieved from cOAlition S Journal Checker Tool[^checkertool]  provided information about journal portfolios and participating institutions. 
After identifying hybrid journals by excluding fully open access journals, Crossref [@Hendricks_2020] served as the primary data source for article-level metadata including Creative Commons (CC) license information to indicate open access availability on publisher websites.
Because of a lack of comprehensive publicly available invoicing data, open access articles published through transformative agreements were determined by linking first author affiliations from OpenAlex [@priem2022openalex] to eligible institutions according to the transformative agreement data. 
In the following, the steps are described in detail.


```{r data_workflow, echo=FALSE, fig.cap="Data collection workflow"}
knitr::include_graphics(here::here("analysis", "data_collection_workflow.pdf"))
```

## Transformative agreement and hybrid journal data

```{r journal_oa_exclusion}
# ESAC 13 December snapshot
esac_df <- readxl::read_xlsx(here::here("data", "esac.xlsx"), skip = 2) 

# TA statistics
## TAs in ESAC as of 13 December
tas_in_esac <- esac_df |> 
  distinct(ID)
tas_in_esac_and_hoad <- esac_df |>
  filter(ID %in% hoaddata::jct_hybrid_jns$esac_id) |>
  filter(Publisher != "National Academy of Sciences")
tas_in_esac_and_hoad_active_in_2018_22 <- tas_in_esac_and_hoad |>
  filter(`End date` >= as.Date("2018-01-01") & `Start date` < as.Date("2023-01-01")) 


#' OA journal check
oa_journal_status <- readr::read_csv(here::here("data", "oa_journal_status.csv")) 
oa_prop <- readr::read_csv(here::here("data", "oa_prop.csv"))
oa_prop_yearly <- readr::read_csv(here::here("data", "oa_prop_yearly.csv"))


# OA journal total
n_oa_journals <- oa_journal_status %>%
  filter(openalex == TRUE | doaj == TRUE | bielefeld == TRUE) %>% 
  distinct(issn_l) %>%
  nrow()
# By source
#
# GOLD OA
bielefeld <- oa_journal_status %>%
  filter(bielefeld == TRUE) %>% 
  distinct(issn_l)  %>%
  pull()
# DOAJ
doaj <- oa_journal_status %>%
  filter(doaj == TRUE) %>% 
  distinct(issn_l) %>%
  pull()
# OpenAlex venue
openalex <- oa_journal_status %>%
  filter(openalex == TRUE) %>% 
  distinct(issn_l) %>%
  pull()
my_venn <- list(`GOLD OA` = bielefeld, `DOAJ` = doaj, `OpenAlex` = openalex)

p <-
  ggvenn::ggvenn(
    my_venn,
    fill_color = c("#8dd3c7",
          "#ffffb3",
          "#bebada"),
    digits = 0,
    stroke_color = "white",
    text_color = "black",
    text_size = 2.5,
    set_name_size = 2.5
  ) +
  labs(xlab = NULL, xlab = NULL)
```

Data gathering started with obtaining journals included in transformative agreements from the publicly available Transformative Agreement Data dump[^tadump] used by the cOAlition S Journal Checker Tool[^checkertool], a voluntary effort based on publicly disclosed contracts in the ESAC Transformative Agreement Registry[^esacregistry]. 
The dump consists of multiple online Google spreadsheets where each data file represents one agreement listed in the ESAC Transformative Agreement Registry.
From the retrieved spreadsheet files, journals and institutions involved per agreement were obtained.

It should be noted that although many library consortia see the need to register their agreements through the ESAC registry, some fail to disclose all details, including the full-text of contracts [@Bakker_2024; @Kramer_2024]. 
Furthermore, the extent to which ESAC is comprehensive remains uncertain, potentially limiting the coverage of transformative agreements in the Journal Checker Tool. 
Another limitation of using the Journal Checker Tool and its underlying publicly available data dump to study the development of transformative agreements over time is that expired transformative agreements are constantly removed. 
To address this, four different snapshots were safeguarded and combined for this study: self-archived versions from July 2021, July 2022, and May 2023, as well as the most current dump downloaded on 11 December 2023.
This ensured that transformative agreements, which ended from 2021 onwards, were included, representing the majority of transformative agreements.
<!-- Agreements ending before 2021 could not be obtained.-->
Overall, the four combined Transformative Agreement Data dumps used in this study contained `r  length(unique(hoaddata::jct_hybrid_jns$esac_id))` of `r length(unique(esac_df$ID))` agreements listed in the ESAC Transformative Agreement Registry by December 2023. 

The Transformative Agreement Data dumps link agreements to journals represented by journal names and the ISSN. 
After mapping ISSN variants to the corresponding linking ISSN (ISSN-L), as provided by the ISSN International Centre, journals were associated with publishers according to the ESAC Transformative Agreement Registry. 
This reflects that some portfolios may include imprints.
Furthermore, journal subjects according to the All Science Journal Classification (ASJC) were added from the Scopus journal source list as of August 2023.

Because transformative agreements can include both fully open access and hybrid journals, the data were complemented with information about a journal's open access status using multiple sources: the Directory of Open Access Journals (DOAJ) downloaded on 12 December 2023[^doaj], OpenAlex (November 2023) and the Bielefeld list of GOLD OA journals [@goldoa]. 
As shown in Figure \ref{fig:method_fig}A, combining different data sources considerably extended journal matching<!-- to exclude full open access journals from transformative agreements-->.
In total, `r n_oa_journals` full open access journals were excluded based on ISSN matching.
The overlap between the three data sources was `r round(length(unique(Reduce(intersect, my_venn))) / length(unique(Reduce(union, my_venn)))* 100,0)`%.
The Gold OA journals dataset alone added `r length(unique(Reduce(setdiff, my_venn)))` journals, while the DOAJ comprised `r length(setdiff(my_venn$DOAJ, union(my_venn[["GOLD OA"]], my_venn$OpenAlex)))` fully open access journals not listed in either of the other two sources. 
These fully open access journals were launched in 2022.

## Article and author metadata

After identifying hybrid journals included in transformative agreements, article metadata were retrieved from the Crossref <!-- and mapped to OpenAlex for obtaining author metadata including affiliations. --> November 2023 database snapshot for the five-year period from 2018 to 2022, according to the issued date, representing the earliest known publication date. 
Because Crossref metadata lacked information to distinguish between original research articles, including reviews, and other types of journal content, which are often not covered by transformative agreements [@Borrego_2020], only articles published in regular issues indicated by numeric pagination were included.
Furthermore, paratext recognition was applied to exclude non-scholarly journal content such as table of contents.

Open access articles in hybrid journals were identified using the Creative Commons (CC) license information in Crossref metadata, with consideration of any CC variant. 
License information relative to the "accepted manuscript (AM)" version was not considered. 
Crossref was used for open access identification because transformative agreement workflows generally require publishers to deliver CC license information to this DOI registration agency [@Geschuhn_2017].

Comparing Crossref license coverage with OpenAlex, which re-uses open access evidence from Unpaywall, a widely used open access discovery service that also parses journal websites for open content licenses [@Piwowar_2018], highlighted ongoing challenges in identifying hybrid open access [@Mart_n_Mart_n_2018; @Jahn_2021; @Zhang_2022; @Butler_2023].
For the purpose of this study, `r hoaddata::cr_upw |> filter(cr_year %in% 2018:2022, cat == "Global", issn_l != "0027-8424") |> distinct(issn_l, cr_year, cr_hybrid_total) |> pull(cr_hybrid_total) |> sum()` articles under CC license were retrieved using Crossref, while `r hoaddata::cr_upw |> filter(cr_year %in% 2018:2022, cat == "Global", issn_l != "0027-8424") |> distinct(issn_l, cr_year, upw_hybrid_total) |> pull(upw_hybrid_total) |> sum()` articles were tagged as "hybrid" according to the OpenAlex November 2023 release, which was used throughout this study.
The largest differences concerned articles published between 2018 and 2020.
With regard to the publication year 2022, however, Crossref and OpenAlex open access numbers differ only slightly (`r hoaddata::cr_upw |> filter(cr_year %in% 2022, cat == "Global", issn_l != "0027-8424") |> distinct(issn_l, cr_year, cr_hybrid_total) |> pull(cr_hybrid_total) |> sum()` records using Crossref vs. `r hoaddata::cr_upw |> filter(cr_year %in% 2022, cat == "Global", issn_l != "0027-8424") |> distinct(issn_l, cr_year, upw_hybrid_total) |> pull(upw_hybrid_total) |> sum()` in OpenAlex).
Notable differences could be observed among some publishers that presumably did not provide CC license information to Crossref, including AIP Publishing, the American Physiological Society, Emerald, and the Royal Society.
Crossref license metadata was more complete with regard to the articles published by Wiley and the American Chemical Society.
Finally, inconsistent open access status information in previous OpenAlex versions was observed [@jahn2023]. 
After reporting this to OpenAlex, fixing this issue was still ongoing according to the release notes, which might also explain part of the discrepancy.

After retrieving the article metadata, the publication volume, including open access, was calculated for each journal. 
To improve the identification of hybrid journals, journals with an open access proportion above 95% were excluded.
This step allowed removing additional `r length(unique(oa_prop_yearly$issn_l))` fully open access journals.
Together, these journals published `r sum(oa_prop_yearly$articles)` articles between 2018 and 2022. 

Affiliation metadata about corresponding authors are crucial for the planning and evaluation of transformative agreements because they are considered responsible for arranging open access publication [@Schimmer_2015; @Geschuhn_2017; @Borrego_2020]. 
For this study, country and institutional affiliations were retrieved from OpenAlex.
Because the corresponding authorship field was not fully supported by OpenAlex at the time of analysis, and respective affiliation data were only available for 54% of the investigated articles, this study focused on first authors and their affiliations instead; approximately 90% of the articles examined had first author affiliation metadata in OpenAlex, which is a much larger proportion than previously reported for the October 2022 snapshot [@Zhang_2024].
First authors typically contribute the most to a paper and are often considered as lead authors [@Larivi_re_2016; @Chinchilla_Rodr_guez_2024].
In case of lacking data about corresponding authors in bibliometric databases, related studies also utilised first authors as a proxy to examine open access payments and transformative agreements [@Zhang_2022; @Shu_2023; @Haucap_2021].

```{r cr_stats_overview}
cr_stats <- readr::read_csv(here::here("data", "cr_stats.csv"))
cr_stats_plot <- cr_stats |>
  mutate(cat = case_when(
    is.na(src) & oa_status == "gold" ~ "gold",
    src == "hoad" ~ "hoad",
    .default = "other"
  )) |>
  group_by(cr_year, cat) |>
  summarise(n = sum(n_articles)) |>
  mutate(cat = factor(cat, levels = c("hoad", "other", "gold"))) |>
  mutate(prop = n / sum(n)) |>
  ggplot(aes(gsub("^20", "'", as.character(cr_year)), n, fill = cat)) +
  geom_bar(
    position = position_stack(reverse = TRUE),
    color = "black",
    stat = "identity"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)),
                     labels =  scales::number_format(big.mark = ",")) +
  scale_fill_manual(
    "Journal",
    values = c(
      "hoad" = "#998ec3",
      "other" = "#f7f7f7",
      "gold" = "#f1a340"
    ),
    labels = c(
      "hoad" = "Hybrid (TA)",
      "other" = "Other",
      "gold" = "Full OA"
    )
  ) +
  theme_minimal() +
  labs(x = "Publication Year", y = "Total Articles") +
  guides(fill = guide_legend(reverse = TRUE)) +
  theme(
    panel.grid.minor = element_blank(),
    panel.border = element_rect(color = "grey50", fill = NA),
    axis.title = element_text(size = 10)#,
  #  legend.position = "right",
  #  legend.justification = "right"
  ) 
```

To estimate the impact of transformative agreements on hybrid open access, participating institutions from the Transformative Agreement Data dump, which the cOAlition S crowd-sourced from  agreement documents and consortia, were matched with the first author affiliations recorded by OpenAlex using the ROR-ID.
Matching also considered the duration of agreements according to the ESAC registry. 
In total, `r length(unique(tas_in_esac_and_hoad_active_in_2018_22$ID))` agreements were active between 2018 and 2022.
Upon inspection, Transformative Agreement Data did not comprehensively cover associated institutions, such as university hospitals or institutes of large research organisations such as the Max Planck Society.
To improve the matching, Transformative Agreement Data were automatically enriched with ROR-IDs from associated organisations according to OpenAlex's institution entity data. 

```{r method_fig, fig.asp=0.55, fig.cap="Initial data characteristics. (A) Full open access journals included in transformative agreements by evidence source Directory of Open Access Journals (DOAJ), OpenAlex and the Bielefeld GOLD OA list. (B) Number of articles in Crossref by journal types. The purple bars show the overall article volume of hybrid journals in transformative agreements, which were initially included in the study, in comparision with full open access journals according to OpenAlex. The remainder represents articles in subscription-based journals not covered by transformative agreements."}
(p | cr_stats_plot) + plot_annotation(tag_levels = 'A') +  plot_layout(widths = c(0.6, 0.4))
```

The so compiled data set consists of `r hoaddata::jn_ind |> filter(issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |> distinct(issn_l, cr_year, jn_all) |> pull(jn_all) |> sum()` articles published in `r hoaddata::jn_ind |> filter(issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |> distinct(issn_l) |> nrow()` hybrid journals included in at least one transformative agreement between 2018 and 2022 (see purple bars in Figure \ref{fig:method_fig}B). 
These hybrid journals in transformative agreements represented `r cr_stats |> filter(src == "hoad") |> pull(n_articles) |> sum() / cr_stats |> pull(n_articles) |> sum() * 100`%  of the total global output over the same time period, according to Crossref, while fully open access journals recorded 
`r cr_stats |> filter(is.na(src) & oa_status == "gold") |> pull(n_articles) |> sum() / cr_stats |> pull(n_articles) |> sum() * 100`%.

<!-- To reflect the increasing trend towards multiple and cross-country affiliations (Hottenrott et al., 2021; Larivière et al., 2015), articles were counted once per country. -->

## Data analysis

Throughout this mostly automated data gathering and analysis process, Tidyverse tools (Wickham et al., 2019) for the R programming language (R Core Team, 2020) were used. 
The resulting data are openly available through an R data package, hoaddata [@hoaddata]. 
Following @Marwick_2018, hoaddata contains not only the datasets used in the data analysis. 
It also includes code used to compile the data by connecting it to a cloud-based Google BigQuery data warehouse, where scholarly big data from Crossref, OpenAlex and Unpaywall were made available, using bigrquery [@bigrquery].
To increase computational reproducibility, data aggregation through hoaddata was automatically carried out using GitHub Actions, a continuous integration service.


# Results

```{r overview_data_prep}
ta_oa_growth <- ta_oa_inst |>
  filter(ta_active == TRUE, !is.na(cc), issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  group_by(cr_year) |>
  summarise(ta_oa = n_distinct(doi))
hybrid_oa_growth <- hoaddata::cc_articles |>
  filter(issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  group_by(cr_year) |>
  summarise(oa_all = n_distinct(doi))
ta_df <- inner_join(ta_oa_growth, hybrid_oa_growth) |>
  mutate(ta_oa_prop = ta_oa / oa_all) |>
  mutate(no_ta = oa_all - ta_oa, 
         no_ta_prop = 1 - ta_oa_prop) |>
  mutate(cr_year = as.factor(cr_year))
# year all
year_all <-
  hoaddata::jn_ind |>
  filter(issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  filter(issn_l %in% hoaddata::cc_articles$issn_l) |>
  distinct(issn_l, cr_year, jn_all) |> 
  group_by(cr_year) |> 
  summarise(n = sum(jn_all))

## Hybrid Journals
 n_hybrid_jns_all <- hoaddata::jn_ind |>
  filter(issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  distinct(issn_l) |>
   nrow()
 
## Hybrid Journals with at least one OA article
n_hybrid_jns <- hoaddata::cc_articles |>
  filter(issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  group_by(issn_l) |>
  summarise(oa_all = n_distinct(doi)) |> 
  nrow()

## Hybrid Journals with at least one OA article
n_ta_jns <- ta_oa_inst |>
  filter(ta_active == TRUE, !is.na(cc), issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  distinct(issn_l) |>
  nrow()

## Hybrid Journals with at least one TA-OA article
n_tas_with_oa <- ta_oa_inst |>
  filter(ta_active == TRUE, !is.na(cc), issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  distinct(ta_journal_portfolio) |>
  nrow()

## Open access volume
n_oa <-  hoaddata::cc_articles |>
  filter(issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  distinct(doi) |>
  nrow()

## Total
n_total <- hoaddata::jn_ind |>
  filter(issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  filter(issn_l %in% hoaddata::cc_articles$issn_l) |>
  distinct(issn_l, cr_year, jn_all) |>
  pull(jn_all) |>
  sum()

## TA total
n_tas_with_oa <- ta_oa_inst |>
  filter(ta_active == TRUE, !is.na(cc), issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  distinct(ta_journal_portfolio) |>
  nrow()

## TA article total
n_ta_oa <- ta_oa_inst |>
  filter(ta_active == TRUE, !is.na(cc), issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  distinct(doi) |>
  nrow()
```

## Overview

Between 2018 and 2022, `r n_hybrid_jns` out of `r n_hybrid_jns_all` hybrid journals in transformative agreements published at least one open access article under a Creative Commons license.
These eligible `r n_hybrid_jns` hybrid journals constituted the foundation for the subsequent analyses. 
Collectively, they provided open access to `r n_oa` out of `r n_total` articles during the investigated period, representing a five-year open access proportion of `r n_oa / n_total * 100`%.
Authors who could make use of transformative agreements at the time of publication contributed `r n_ta_oa` (`r n_ta_oa / n_oa * 100`%) open access articles.
Overall, this investigation was able to establish a link between open access articles and eligible institutions for `r n_tas_with_oa` out of `r length(unique(tas_in_esac_and_hoad_active_in_2018_22$ID))` (`r n_tas_with_oa / length(unique(tas_in_esac_and_hoad_active_in_2018_22$ID)) * 100`%) active transformative agreements between 2018 and 2022 through the linking of first author affiliations with agreement data. 


```{r area_oa_over_the_years}
oa_ta_plot_df <- ta_df |>
  select(cr_year, ta_oa, no_ta) |>
  pivot_longer(cols = c(ta_oa, no_ta), names_to = "type", values_to = "value") |>
  filter(!cr_year %in%  c("2017", "2023")) |>
  inner_join(year_all)
  # plot
oa_ta_plot <-
  ggplot(oa_ta_plot_df, aes(cr_year, value / n, fill = type, group = type)) +
  geom_area(color = "#000000",
            linewidth = 0.15) +
  scale_fill_manual(
    NULL,
    values = c(no_ta = "#b3b3b3a0", ta_oa = "#56B4E9"),
    labels = c(no_ta = "Other", ta_oa = "Agreement"),
    guide = guide_legend(reverse = TRUE)
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.05)),
    labels = scales::percent_format(),
    limits = c(0, .15),
    breaks = c(0, .05, .1, .15)
  ) +
  theme_minimal() +
  labs(y = "Hybrid OA Uptake", x = NULL) +
  theme(
    legend.position = "top",
    legend.justification = "left",
    axis.text.x = element_blank()
  )
```

```{r ta_share_plot}
ta_share_plot <- ta_df |>
  select(cr_year, ta_oa_prop, no_ta_prop) |>
  pivot_longer(cols = c(ta_oa_prop, no_ta_prop), names_to = "type", values_to = "value") |>
  filter(!cr_year %in%  c("2017", "2023"), type == "ta_oa_prop") |>
  ggplot(aes(gsub("^20", "'", as.character(cr_year)), value, group = 1)) +
  geom_bar(stat = "identity", fill = "#56B4E9", color = "#000000", linewidth = 0.15) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)), breaks = c(0, 0.25, 0.5),
                     labels = scales::percent) +
  theme_minimal() +
  labs(y = "Percentage\nof Hybrid OA\nvia Agreement", x = "Publication Year")
```

```{r journal_boxplot}
jn_hybrid_oa_growth <- hoaddata::cc_articles |>
  filter(issn_l != "0027-8424") |>
  group_by(cr_year, issn_l) |>
  summarise(oa_all = n_distinct(doi)) |>
  mutate(cr_year = factor(cr_year))
# year all
jn_year_all <-
  hoaddata::jn_ind |>
  filter(issn_l != "0027-8424") |>
  filter(issn_l %in% hoaddata::cc_articles$issn_l) |>
  distinct(issn_l, cr_year, jn_all) |> 
  group_by(cr_year, issn_l) |> 
  summarise(n = sum(jn_all))

oa_jn_box_df <- left_join(jn_hybrid_oa_growth, jn_year_all) |>
  mutate(prop = oa_all / n) |> 
  filter(!cr_year %in%  c("2017", "2023"))
oa_jn_box <- oa_jn_box_df |>
  ggplot(aes(gsub("^20", "'", as.character(cr_year)), prop)) +
  geom_boxplot(outlier.shape = NA) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)),
                     labels = scales::percent) +
  coord_cartesian(ylim = c(0,0.65)) +
  theme_minimal() +
  labs(y = "OA Uptake per Hybrid Journal", x = "Publication Year")
```

```{r}
ta_oa_growth <- ta_oa_inst |>
  filter(ta_active == TRUE, !is.na(cc), issn_l != "0027-8424") |>
  group_by(cr_year, issn_l) |>
  summarise(ta_oa = n_distinct(doi))
hybrid_oa_growth <- hoaddata::cc_articles |>
  filter(issn_l != "0027-8424") |>
  group_by(cr_year, issn_l) |>
  summarise(oa_all = n_distinct(doi))
ta_df <- left_join(hybrid_oa_growth, ta_oa_growth) |>
  mutate(across(everything(), .fns = ~replace_na(.,0))) |>
  mutate(no_ta = oa_all - ta_oa) |>
  mutate(cr_year = as.factor(cr_year))

summary_all <- inner_join(ta_df, jn_year_all, by = c("cr_year", "issn_l")) |>
  mutate(prop_ta_oa = ta_oa / n,
         prop_no_ta = no_ta / n) |>
  ungroup() |>
  distinct(cr_year, issn_l, prop_ta_oa, prop_no_ta) |>
  pivot_longer(cols = c(prop_ta_oa, prop_no_ta))
# plot
box_ta_prop <- summary_all |>
  filter(!cr_year %in%  c("2017", "2023")) |>
  # With at least one OA article
  filter(value > 0) |>
  ggplot(aes(gsub("^20", "'", as.character(cr_year)), value, fill = name)) +
  geom_boxplot(outlier.shape = NA, varwidth = TRUE) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)),
                     labels = scales::percent) +
  coord_cartesian(ylim = c(0,0.65)) +
  scale_fill_manual(NULL, values = c(prop_no_ta = "#b3b3b3a0", prop_ta_oa = "#56B4E9"), labels = c(prop_no_ta = "Other", prop_ta_oa = "Agreement"), guide = FALSE) +
  theme_minimal() +
  labs(y = NULL, x = "Publication Year")
```

```{r results_overview}
#| fig-cap: "Relative growth of open access in hybrid journals in transformative agreements between 2018 and 2022 per publication year. The blue areas represent open access through transformative agreements, the grey areas depict open access articles where no link to an agreement could be established. (A) Proportion of open access articles in hybrid journals per year. (B) Percentage of hybrid open access via agreements per year. Boxplots show the proportion of open access articles by individual hybrid journals (C) and individual open access uptake rates by individual hybrid journals and open access funding (D) per publication year. The individual outliers are not shown. Note that data on transformative agreements ending before June 2021 were not available for this study."


layout = "
EEE
ACD
BCD"
wrap_plots(
  E = guide_area(),
  A = oa_ta_plot,
  B = ta_share_plot,
  C = oa_jn_box,
  D = box_ta_prop,
  design = layout,
  widths = c(0.4, 0.3, 0.3),
  heights = c(0.2, 1, .5),
  guides = "collect") &
  theme(
    legend.position = "top",
    legend.justification = "right",
    legend.direction = "horizontal",
 #   panel.grid.minor = element_blank(),
    panel.border = element_rect(color = "grey50", fill = NA),
    axis.title=element_text(size = 10)) &
    plot_annotation(tag_levels = 'A')
```

```{r}
# in text data
oa_by_year <- oa_ta_plot_df |>
  group_by(cr_year) |>
  summarise(oa = sum(value),
            articles = n) |>
  mutate(prop = oa / articles * 100) |>
  distinct()
```

Figure \ref{fig:results_overview}A shows a moderate growth in the proportion of open access articles in hybrid journals, comparing the overall open access uptake and the impact of transformative agreements on this trend.
Over the five-years period from 2018 to 2022, open access in hybrid journals increased from `r oa_by_year |> filter(cr_year == "2018") |> pull(prop)`% (n = `r oa_by_year |> filter(cr_year == "2018") |> pull(oa)`) to `r oa_by_year |> filter(cr_year == "2022") |> pull(prop)`% (n = `r oa_by_year |> filter(cr_year == "2022") |> pull(oa)`). 
Simultaneously, the total article volume of the investigated journals rose from `r oa_by_year |> filter(cr_year == "2018") |> pull(articles)` in 2018 to `r oa_by_year |> filter(cr_year == "2022") |> pull(articles)` in 2022.

Figure \ref{fig:results_overview}B highlights that the majority of hybrid open access was made available through transformative agreements in 2021 and 2022.
In 2022, `r  oa_ta_plot_df |> filter(cr_year == "2022", type == "ta_oa") |> pull(value)` out of `r oa_by_year |> filter(cr_year == "2022") |> pull(oa)` open access articles were from eligible authors, representing `r oa_ta_plot_df |> filter(cr_year == "2022", type == "ta_oa") |> pull(value) / oa_by_year |> filter(cr_year == "2022") |> pull(oa) * 100`%.
However, there was also a notable increase in open access provision through other means, presumably publication fees being not invoiced through transformative agreements as indicated by the grey area in \ref{fig:results_overview}A, from `r oa_ta_plot_df |> filter(cr_year == "2018", type == "no_ta") |> mutate(prop = value / n * 100) |> pull(prop)`% (n = `r oa_ta_plot_df |> filter(cr_year == "2018", type == "no_ta") |> pull(value)`) in 2018 to  `r oa_ta_plot_df |> filter(cr_year == "2022", type == "no_ta") |> mutate(prop = value / n * 100) |> pull(prop)`% (n = `r oa_ta_plot_df |> filter(cr_year == "2022", type == "no_ta") |> pull(value)`) in 2022. 
<!-- This suggests that publishers were able to gain equally from individual and institutional open access publishing options.-->

Figure \ref{fig:results_overview}C depicts the substantial variations among the hybrid journals included in transformative agreements in terms of open access uptake.
Although the median generally follows the trend shown in Figure \ref{fig:results_overview}A, the farther stretch of upper quartiles and whiskers over the years illustrates that an increasing number of journals published an above-average proportion of open access articles. 
In 2022, 25% of hybrid journals (n = `r oa_jn_box_df |> filter(cr_year == "2022") |> mutate(top25 = quantile(prop, .75)) |> filter(prop >= top25) |> nrow()`) had an open access uptake of `r oa_jn_box_df |> filter(cr_year == "2022") |> pull(prop) |> quantile(0.75)*100`%, and `r (oa_jn_box_df |> filter(cr_year == "2022", prop >= 0.5) |> nrow()) / length(unique(oa_jn_box_df$issn_l)) *100`% of journals (n = `r oa_jn_box_df |> filter(cr_year == "2022", prop >= 0.5) |> nrow()`) provided the majority of their articles under a CC license in the same year. 
On average, these journals were smaller (M = `r oa_jn_box_df |> filter(cr_year == "2022", prop >= 0.5) |> pull(n) |> mean()`, SD = `r oa_jn_box_df |> filter(cr_year == "2022", prop >= 0.5) |> pull(n) |> sd()`) than those with an open access share below 50% (M = `r oa_jn_box_df |> filter(cr_year == "2022", prop <= 0.5) |> pull(n) |> mean()`, SD = `r oa_jn_box_df |> filter(cr_year == "2022", prop <= 0.5) |> pull(n) |> sd()`). 
<!-- Notable exception of large journals with an above-average open access proportion were Physical Review D, a high-energy physics journal covered by the SCOAP3 consortium that provided open access to `r oa_jn_box_df |> filter(cr_year == "2022", issn_l == "2470-0010") |> pull(oa_all)` out of `r oa_jn_box_df |> filter(cr_year == "2022", issn_l == "2470-0010") |> pull(n)` articles in 2022, Astronomy and Physics (`r oa_jn_box_df |> filter(cr_year == "2022", issn_l == "0004-6361") |> pull(oa_all)` out of `r oa_jn_box_df |> filter(cr_year == "2022", issn_l == "0004-6361") |> pull(n)` articles in 2022 were open access), which shifted to a subscribe to open business model for all accepted articles as of April 2022, and the Journal of Fluid Mechanics (`r oa_jn_box_df |> filter(cr_year == "2022", issn_l == "0022-1120") |> pull(oa_all)` of `r oa_jn_box_df |> filter(cr_year == "2022", issn_l == "0022-1120") |> pull(n)` articles in 2022 were open access). -->

When comparing the impact of open access through transformative agreements across journals, it shows that for many journals, these agreements substantially contributed to the growth of open access over the years (Figure \ref{fig:results_overview}D). 
<!-- Examples of such journals include those with a scope on specific countries or regions, where also transformative agreements were implemented. 
For instance, in 2022, the Germany-based journals Zeitschrift für Erziehungswissenschaft and Zeitschrift für Politikwissenschaft, as well as the Scandinavian Political Studies adressing the Nordic countries, achieved an overall open access uptake of more than 90% just through transformative agreements. -->
Despite the rise in transformative agreements, it is worth noting that other means of publishing open access remained common across the investigated hybrid journals. 
In total, `r summary_all |> filter(cr_year == "2022", value > 0, name == "prop_no_ta") |> nrow()` journals published open access articles from authors affiliated with institutions without transformative agreements in place, while `r summary_all |> filter(cr_year == "2022", value > 0, name == "prop_ta_oa") |> nrow()` journals published at least one open access article through a transformative agreement in the same year.

## Publishing market

```{r}
jn_ind_jct <- hoaddata::jct_hybrid_jns |>
  inner_join(hoaddata::jn_ind, by = "issn_l") |>
  filter(issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  filter(issn_l %in% hoaddata::cc_articles$issn_l)

ta_active <- ta_oa_inst |>
  filter(issn_l %in% jn_ind_jct$issn_l) |>
  filter(ta_active == TRUE, !is.na(cc)) |>
  group_by(cr_year, issn_l, esac_publisher) |>
  summarise(ta_oa = n_distinct(doi)) |>
  mutate(cr_year = as.character(cr_year))

jn_ind_jct_oa <- jn_ind_jct |>
  filter(!is.na(cc)) |>
  distinct(cr_year, issn_l, esac_publisher, cc, cc_total, jn_all) |>
  group_by(cr_year, issn_l, esac_publisher, jn_all) |>
  summarise(oa = sum(cc_total, na.rm = TRUE))

jn_ind_jct_all <- jn_ind_jct |>
  filter(issn_l %in% hoaddata::cc_articles$issn_l) |>
  distinct(cr_year, issn_l, esac_publisher, jn_all) 

publisher_df <- left_join(jn_ind_jct_all, jn_ind_jct_oa) |>
  mutate(cr_year = as.character(cr_year)) |>
  left_join(ta_active) |>
  mutate(across(everything(), .fns = ~replace_na(.,0))) |>
   mutate(no_ta = oa - ta_oa) |>
    mutate(
    publisher = case_when(
      esac_publisher == "Elsevier" ~ "Elsevier",
      esac_publisher == "Springer Nature" ~ "Springer Nature",
      esac_publisher == "Wiley" ~ "Wiley",
      is.character(esac_publisher) ~ "Other"
    )
  ) |>
  mutate(publisher =
           forcats::fct_relevel(
             publisher,
             c("Elsevier", "Springer Nature", "Wiley", "Other") 
           )) |>
  filter(!cr_year %in%  c("2017", "2023")) |>
  # Journal transfers across publishers grouped in publisher
  select(-esac_publisher) |>
  distinct()

## plot
publisher_plot_df <- publisher_df |> 
  pivot_longer(cols = c(ta_oa, no_ta), names_to = "type", values_to = "value")


#+ publisher ta shares
publisher_ta_prop <- publisher_plot_df |>
  filter(type == "ta_oa") |>
  group_by(cr_year, publisher) |>
  summarize(ta_oa = sum(value), oa = sum(oa), jn_all = sum(jn_all)) |>
  mutate(prop = ta_oa / oa) 


oa_publisher <- publisher_plot_df |>
  group_by(cr_year, publisher, type) |>
  summarise(value = sum(value))
all_publisher <- publisher_plot_df |>
  distinct(cr_year, issn_l, publisher, jn_all) |>
  group_by(cr_year, publisher) |>
  summarise(jn_all = sum(jn_all))

publisher_summary_df <- inner_join(oa_publisher, all_publisher) |>
  mutate(prop = value / jn_all)


publisher_prop <-
  ggplot(publisher_summary_df, aes(
    gsub("^20", "'", as.character(cr_year)),
    prop,
    fill = type,
    group = type
  )) +
  geom_area(color = "#000000",
            linewidth = 0.15) +
  facet_wrap( ~ publisher, nrow = 1) +
  scale_fill_manual(
    NULL,
    values = c(no_ta = "#b3b3b3a0", ta_oa = "#56B4E9"),
    labels = c(no_ta = "Other", ta_oa = "Agreement"),
    guide = guide_legend(reverse = TRUE)
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.05)),
    labels = scales::percent_format(),
    breaks = c(0.05, 0.1, 0.15, 0.2, 0.25)
  ) +
  theme_minimal() +
  labs(y = "Hybrid OA Uptake", x = NULL) +
  theme(
    legend.position = "top",
    legend.justification = "left",
    axis.text.x = element_blank()
  )

publisher_boxplot <- publisher_plot_df |>
  filter(value > 0) |>
  ggplot(aes(gsub("^20", "'", as.character(cr_year)), value / jn_all, fill = type)) +
  geom_boxplot(outlier.shape = NA,
               show.legend = FALSE,
               varwidth = TRUE) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)),
                     labels = scales::percent) +
  scale_fill_manual(
    NULL,
    values = c(no_ta = "#b3b3b3a0", ta_oa = "#56B4E9"),
    labels = c(no_ta = "Other", ta_oa = "Agreement")
  ) +
  coord_cartesian(ylim = c(0, 0.65)) +
  facet_wrap( ~ publisher, nrow = 1) +
  labs(y = "OA Uptake\nby Hybrid Journal", x = "Publication Year") +
  theme_minimal() +
  theme(strip.background = element_blank(),
        strip.text.x = element_blank())

publisher_ta_prop_plot <- publisher_ta_prop |>
  ggplot(aes(gsub("^20", "'", as.character(cr_year)), prop)) +
  geom_bar(stat = "identity",
           fill = "#56B4E9",
            color = "#000000",
           linewidth = 0.15) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.05)),
    breaks = c(0, 0.25, 0.5, 0.75),
    limits = c(0, .75),
    labels = scales::percent
  ) +
  facet_wrap( ~ publisher, nrow = 1) +
  theme_minimal() +
  labs(y = "Percentage\nof Hybrid OA\nvia Agreement", x = NULL) +
  theme(
    axis.text.x = element_blank(),
    strip.background = element_blank(),
    strip.text.x = element_blank()
  )
```

```{r publisher_summary_table}
publisher_article_total_table <- publisher_df |>
  group_by(publisher) |>
  summarise(oa_journals = n_distinct(issn_l),
            publisher_total = sum(jn_all)) |>
  mutate(
    jn_perc = oa_journals / sum(oa_journals),
    jn_cum = cumsum(oa_journals) / sum(oa_journals),
    perc = publisher_total / sum(publisher_total),
    cum = cumsum(publisher_total) / sum(publisher_total)
  ) |>
  relocate(publisher_total, .after = jn_cum)

publisher_article_oa_table <- publisher_summary_df |>
  group_by(publisher) |>
  summarise(oa_total = sum(value)) |>
  mutate(oa_perc = oa_total / sum(oa_total),
         oa_cum = cumsum(oa_total) / sum(oa_total))

publisher_article_ta_oa_table <- publisher_summary_df |>
  filter(type == "ta_oa") |>
  group_by(publisher) |>
  summarise(ta_oa_total = sum(value)) |>
  mutate(
    ta_oa_perc = ta_oa_total / sum(ta_oa_total),
    ta_oa_cum = cumsum(ta_oa_total) / sum(ta_oa_total)
  )

publisher_league_tbl <-
  inner_join(publisher_article_total_table, publisher_article_oa_table) |>
  inner_join(publisher_article_ta_oa_table)
```

Analysing hybrid open access across publishers between 2018 and 2022 reveals a large market concentration. 
Although `r length(unique(jn_ind_jct_all$esac_publisher))` publishers offered transformative agreements, the three commercial publishers Elsevier, Springer Nature, and Wiley accounted for `r publisher_league_tbl  |> filter(publisher == "Wiley") |> pull(jn_cum) * 100`% of hybrid journals, representing `r publisher_league_tbl  |> filter(publisher != "Other") |> pull(publisher_total) |> sum()` or `r publisher_league_tbl  |> filter(publisher == "Wiley") |> pull(cum) * 100`% of the total article volume (see Table \ref{tab:publisher_league_table}).
Together, they published `r publisher_league_tbl  |> filter(publisher != "Other") |> pull(oa_total) |> sum()` or `r publisher_league_tbl  |> filter(publisher == "Wiley") |> pull(oa_cum) * 100`% of the open access articles in hybrid journals.
Elsevier, Springer Nature, and Wiley made `r publisher_league_tbl  |> filter(publisher != "Other") |> pull(ta_oa_total) |> sum()` articles open access in hybrid journals through transformative agreements, resulting in an even larger market share of `r publisher_league_tbl  |> filter(publisher == "Wiley") |> pull(ta_oa_cum)*100`%.

```{r publisher_league_table}
publisher_league_tbl |>
  mutate(across(contains(c("perc")), ~ paste(round(., 3) * 100))) |>
  select(-contains("cum")) |>
  kbl(
    booktabs = TRUE, format.args = list(big.mark = ","), digits = 1, escape = TRUE, position = "H",
    caption ="Hybrid open access through transformative agreements market shares 2018-2022",
    col.names = c(
      "Publisher",
      "Total",
      "%",
      "Total",
      "%",
      "Total",
      "%",
      "Total",
      "%"
    )
  ) |>
  kable_styling(position = "center") |>
  add_header_above(c(
    " " = 1,
    "Hybrid journals" = 2,
    "Articles" = 2,
    "OA Articles" = 2,
    "TA OA Articles" = 2
  ))
```

However, there are notable differences between the three large publishers. Although Elsevier published the largest volume of articles (n = `r publisher_league_tbl  |> filter(publisher == "Elsevier") |> pull(publisher_total)`; `r publisher_league_tbl  |> filter(publisher == "Elsevier") |> pull(cum)*100`%), it recorded a comparably low number of open access articles, including those that are associated with transformative agreements.
In contrast, Springer Nature and Wiley provided open access to a larger proportion of their articles (`r (publisher_league_tbl  |> filter(publisher == "Springer Nature") |> pull(oa_total)) / (publisher_league_tbl  |> filter(publisher == "Springer Nature") |> pull(publisher_total)) * 100`% of Springer Nature articles and `r (publisher_league_tbl  |> filter(publisher == "Wiley") |> pull(oa_total)) / (publisher_league_tbl  |> filter(publisher == "Wiley") |> pull(publisher_total)) * 100`% of Wiley articles were open access), leading to higher open access market shares (`r publisher_league_tbl  |> filter(publisher == "Springer Nature") |> pull(oa_perc)*100`% Springer Nature resp. `r publisher_league_tbl  |> filter(publisher == "Springer Nature") |> pull(oa_perc)*100`% Wiley).
This difference between Elsevier on the one hand and Springer Nature and Wiley on the other can be attributed to transformative agreements, as the latter made the majority of their open access articles available through such deals (`r ((publisher_league_tbl  |> filter(publisher == "Springer Nature") |> pull(ta_oa_total)) / (publisher_league_tbl  |> filter(publisher == "Springer Nature") |> pull(oa_total)) * 100)`% Springer Nature  resp. `r (publisher_league_tbl  |> filter(publisher == "Wiley") |> pull(ta_oa_total)) / (publisher_league_tbl  |> filter(publisher == "Wiley") |> pull(oa_total)) * 100`% Wiley).

Figure \ref{fig:publisher_figure} takes a closer look into the growth of hybrid open access across publishers by year, with a focus on open access enabled by transformative agreements. 
Although all publishers show a general long-term trend towards transformative agreements, Figure \ref{fig:publisher_figure}A and B indicate that Wiley experienced a substantial increase in its open access share from `r publisher_summary_df |> filter(cr_year == "2018", publisher == "Wiley") |> pull(prop) |> sum()*100`% (n = `r publisher_summary_df |> filter(cr_year == "2018", publisher == "Wiley") |> pull(value) |> sum()`) in 2018 to `r publisher_summary_df |> filter(cr_year == "2022", publisher == "Wiley") |> pull(prop) |> sum()*100`%  (n = `r publisher_summary_df |> filter(cr_year == "2022", publisher == "Wiley") |> pull(value) |> sum()`) in 2022. 
In contrast, Elsevier's hybrid journals demonstrated a more modest increase, from `r publisher_summary_df |> filter(cr_year == "2018", publisher == "Elsevier") |> pull(prop) |> sum()*100`% (n = `r publisher_summary_df |> filter(cr_year == "2018", publisher == "Elsevier") |> pull(value) |> sum()`) in 2018 to `r publisher_summary_df |> filter(cr_year == "2022", publisher == "Elsevier") |> pull(prop) |> sum()*100`% (n = `r publisher_summary_df |> filter(cr_year == "2022", publisher == "Elsevier") |> pull(value) |> sum()`) in 2022, which is a relatively low open access share compared to the general trend.
In 2018, Springer Nature had the largest open access proportion among the three publishers of `r publisher_summary_df |> filter(cr_year == "2018", publisher == "Springer Nature") |> pull(prop) |> sum()*100`% (n = `r publisher_summary_df |> filter(cr_year == "2018", publisher == "Springer Nature") |> pull(value) |> sum()`), but experienced a relatively slower growth, resulting in `r publisher_summary_df |> filter(cr_year == "2022", publisher == "Springer Nature") |> pull(prop) |> sum()*100`% (n = `r publisher_summary_df |> filter(cr_year == "2022", publisher == "Springer Nature") |> pull(value) |> sum()`) of articles being open access in Springer Nature hybrid journals in 2022.

```{r publisher_figure, fig.asp=0.8, fig.cap="Development of open access in hybrid journals included in transformative agreements between 2018 and 2022 by publishers. The blue areas represent open access through transformative agreements, the grey areas depict open access articles where no link to an agreement could be established. (A) Proportion of open access articles in hybrid journals per year and publisher. (B) Percentage of hybrid open access via agreements per year and publisher. Boxplots (C) show individual open access uptake rates by individual hybrid journals and open access funding per publication year and publisher. The individual outliers are not shown. Note that data on transformative agreements ending before June 2021 were not available for this study."}

design = "E
A
B
C"
wrap_plots(
  E = guide_area(),
  A = publisher_prop,
  B = publisher_ta_prop_plot,
  C = publisher_boxplot,
  design = design,
  guides = "collect",
  heights = c(0, 0.4, 0.3, 0.7)
) &
  theme(
    legend.position = "top",
    legend.justification = "right",
    legend.direction = "horizontal",
#    panel.grid.minor = element_blank(),
                panel.border = element_rect(color = "grey50", fill = NA),
    axis.title=element_text(size = 10)) &
    plot_annotation(tag_levels = 'A') 
```

The varying degrees of adoption of open access across the three major publishers can be attributed to distinct approaches to transformative agreements. 
Springer Nature, for example, started offering open access agreements for its hybrid journal portfolio to selected consortia such as the Max Planck Society, the Swedish Bibsam consortium and the Finnish FinELib consortium in 2015 under the name Springer Compact[^springercompact]. 
Prior to this, Springer had some pilot agreements with a small number of institutions, including the University of Göttingen [@Schmidt_2012].
However, the Springer Compact agreements were not included in the data as they concluded before the start of the transformative agreement data collection in June 2021. 
Nonetheless, the results demonstrate the importance of agreements for Springer Nature's hybrid open access business over the five-years period (Figure \ref{fig:publisher_figure}B).
In 2022, `r publisher_summary_df |> filter(cr_year == "2022", publisher == "Springer Nature", type == "ta_oa") |> pull(value) / publisher_summary_df |> filter(cr_year == "2022", publisher == "Springer Nature") |> pull(value) |> sum()*100`% (n = `r  publisher_summary_df |> filter(cr_year == "2022", publisher == "Springer Nature", type == "ta_oa") |> pull(value)`) of open access in Springer Nature hybrid journals was enabled through transformative agreements.
In the same year, `r publisher_summary_df |> filter(cr_year == "2022", publisher == "Wiley", type == "ta_oa") |> pull(value) / publisher_summary_df |> filter(cr_year == "2022", publisher == "Wiley") |> pull(value) |> sum()*100`% (n = `r publisher_summary_df |> filter(cr_year == "2022", publisher == "Wiley", type == "ta_oa") |> pull(value)`) of Wiley's open access articles could be linked to transformative agreements. 
By contrast, Elsevier published a comparatively lower proportion of its open access articles through transformative agreements in 2022 (n = `r publisher_summary_df |> filter(cr_year == "2022", publisher == "Elsevier", type == "ta_oa") |> pull(value) `; `r publisher_summary_df |> filter(cr_year == "2022", publisher == "Elsevier", type == "ta_oa") |> pull(value) / publisher_summary_df |> filter(cr_year == "2022", publisher == "Elsevier") |> pull(value) |> sum()*100`%).  

```{r}
pub_75 <- publisher_plot_df |> filter(value > 0) |> mutate(prop = value /jn_all) |> group_by(publisher, type, cr_year) |> summarise(
  top25 = quantile(prop, 0.75),
  median = median(prop),
  top10 = quantile(prop, 0.9))
```

The increasing trend towards transformative agreements can also be observed at the journal-level (Figure \ref{fig:publisher_figure}C).
While no substantial differences between open access enabled through transformative agreements and other revenue sources could be seen across Elsevier's portfolio, the distribution of open access across Springer Nature and Wiley hybrid journals indicates that the growth is not limited to a few journals but extends across the portfolio. 
In particular, Wiley's upper quantile, which represents the top 25% of journals in terms of the proportion of open access articles from transformative agreements, increased markedly from `r pub_75 |> filter(publisher == "Wiley", type == "ta_oa", cr_year == "2020") |> pull(top25) * 100`% in 2020 to `r pub_75 |> filter(publisher == "Wiley", type == "ta_oa", cr_year == "2022") |> pull(top25) * 100`% in 2022. Simultaneously, the median proportion increased from `r pub_75 |> filter(publisher == "Wiley", type == "ta_oa", cr_year == "2020") |> pull(median) * 100`% to  `r pub_75 |> filter(publisher == "Wiley", type == "ta_oa", cr_year == "2022") |> pull(median) * 100`%.
It is interesting to note that a small but increasing number of journals from these two publishers provide open access to the majority of articles through transformative agreements.
Wiley recorded `r publisher_plot_df |>  mutate(prop = value / jn_all)  |> filter(cr_year == "2022", prop > 0.5, type == "ta_oa", publisher == "Wiley") |> nrow()` and Springer Nature `r publisher_plot_df |>  mutate(prop = value / jn_all)  |> filter(cr_year == "2022", prop > 0.5, type == "ta_oa", publisher == "Springer Nature") |> nrow()` hybrid journals with an open access share above 50%, which could be attributed solely to transformative agreements. 
Upon inspection, these journals were mainly society or local language journals with small annual article volumes.

## Journal subjects

```{r subject_data_prep}
jn_issnl_ajsc <-
  readr::read_csv(here::here("data", "jn_issnl_ajsc.csv")) |>
  select(issn_l, top_level, subject_area, ajcs)
subject_df <- left_join(jn_ind_jct_all, jn_ind_jct_oa) |>
  mutate(cr_year = as.character(cr_year)) |>
  left_join(ta_active) |>
  mutate(across(everything(), .fns = ~ replace_na(., 0))) |>
  mutate(no_ta = oa - ta_oa) |>
  left_join(jn_issnl_ajsc, by = "issn_l") 

top_level_by_year_jn <- subject_df |>
  # with at least one
  filter(oa > 0) |>
  distinct(cr_year, issn_l, jn_all, top_level) |>
  group_by(cr_year, issn_l, top_level) |>
  summarise(n = sum(jn_all)) |>
  mutate(fractions_factor = n / sum(n)) |>
  mutate(fractions = n * fractions_factor) |>
  ungroup() |> 
  group_by(cr_year, top_level) |>
  summarise(articles_n = sum(n),
            articles_frac = sum(fractions)) |>
  arrange(top_level, cr_year)

top_level_by_year_oa_frac <- subject_df |>
   # with at least one
  filter(oa > 0) |>
  select(-ajcs, -subject_area, -esac_publisher) |>
  distinct(cr_year, issn_l, top_level, .keep_all = TRUE) |>
  group_by(cr_year, issn_l, top_level) |>
  summarise(n = sum(jn_all)) |>
  mutate(fractions_factor = n / sum(n)) |>
  select(-n)

top_level_by_year_oa <- top_level_by_year_oa_frac |>
  inner_join(subject_df) |>
     # with at least one
  filter(oa > 0) |>
  select(-ajcs, -subject_area, -esac_publisher) |>
  distinct(cr_year, issn_l, top_level, .keep_all = TRUE) |>
  mutate(across(c(oa, ta_oa, no_ta),  function(x) x * fractions_factor, .names = "frac_{.col}")) |>
  ungroup() |> 
  group_by(cr_year, top_level) |>
  summarise(oa_n = sum(oa),
            oa_frac = sum(frac_oa),
            ta_oa = sum(ta_oa),
            ta_oa_frac= sum(frac_ta_oa),
            no_ta = sum(no_ta),
            no_ta_fractions = sum(frac_no_ta)) |>
  arrange(top_level, cr_year) |>
  inner_join(top_level_by_year_jn)
```

Table \ref{tab:subject_summary_table} presents a high-level overview of hybrid open access by ASJC subject area using fractional counting to account for journals belonging to more than one category. 
Between 2018 and 2022, most hybrid journals with at least one open access article could be attributed to the Social Sciences category, which also includes Arts and Humanities.
However, these journals published the fewest number of articles, whereas Physical Sciences journals recorded the most articles, followed by Health Sciences and Life Sciences. 
In terms of open access,  Physical Sciences journals accounted for more than one-third of the articles published in the five-year period, followed by Health Sciences, Social Sciences and Life Sciences.


```{r subject_summary_table}
jn_fract <- subject_df |>
  # with at least one
  filter(oa > 0) |>
  distinct(issn_l, top_level) |>
  group_by(issn_l, top_level) |>
  summarise(n = n_distinct(issn_l)) |>
  mutate(fractions_factor = n / sum(n)) |>
  mutate(fractions = n * fractions_factor) |>
  ungroup() |> 
  group_by(top_level) |>
  summarise(jn_frac = sum(fractions)) |>
  arrange(top_level)


subject_tbl <- top_level_by_year_oa |>
  inner_join(jn_fract, by = "top_level") |>
  filter(!top_level %in% c("Multidisciplinary", NA)) |>
  group_by(top_level, jn_frac) |>
  summarise(articles_frac = sum(articles_frac),
            oa_frac = sum(oa_frac),
            ta_oa_frac = sum(ta_oa_frac)) |>
  ungroup() |>
  mutate(
    jn_perc = jn_frac / sum(jn_frac),
    jn_cum = cumsum(jn_frac) / sum(jn_frac),
    perc = articles_frac / sum(articles_frac),
    cum = cumsum(articles_frac) / sum(articles_frac),
    oa_perc = oa_frac / sum(oa_frac),
    oa_cum = cumsum(oa_frac) / sum(oa_frac),
    ta_oa_perc = ta_oa_frac / sum(ta_oa_frac),
    ta_oa_cum = cumsum(ta_oa_frac) / sum(ta_oa_frac)
  ) |>
  select(top_level, jn_frac, jn_perc, jn_cum, articles_frac, perc, cum, 
         oa_frac, oa_perc, oa_cum, ta_oa_frac,ta_oa_perc,  ta_oa_cum)

subject_tbl |>
  mutate(across(contains(c("perc", "cum")), ~ paste(round(., 3) * 100))) |>
  select(-contains("cum")) |>
  kbl(
    booktabs = TRUE, format.args = list(big.mark = ","), digits = 1, escape = TRUE, position = "H",
    caption ="Hybrid open access through transformative agreements by journal subject 2018-2022",
    col.names = c(
      "Journal subject",
      "Total",
      "%",
      "Total",
      "%",
      "Total",
      "%",
      "Total",
      "%"
    )
  ) |>
  add_header_above(c(
    " " = 1,
    "Hybrid journals" = 2,
    "Articles" = 2,
    "OA Articles" = 2,
    "TA OA Articles" = 2
  ))
```


```{r subject_plots}
subject_trend_plot <- top_level_by_year_oa |>
  filter(top_level != "Multidisciplinary") |>
  filter(!cr_year %in%  c("2017", "2023")) |>
  select(cr_year, top_level, contains("frac"),-oa_frac) |>
  pivot_longer(
    cols = c(ta_oa_frac, no_ta_fractions),
    names_to = "type",
    values_to = "value"
  ) |>
  mutate(prop = value / articles_frac) |>
  ggplot(aes(
    gsub("^20", "'", as.character(cr_year)),
    prop,
    fill = type,
    group = type
  )) +
    geom_area(color = "#000000",
            linewidth = 0.15) +
  facet_wrap( ~ top_level, nrow = 1) +
  scale_fill_manual(
    NULL,
    values = c(
      no_ta_fractions = "#b3b3b3a0",
      ta_oa_frac = "#56B4E9"
    ),
    labels = c(no_ta_fractions = "Other", ta_oa_frac = "Agreement"),
    guide = guide_legend(reverse = TRUE)
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.05)),
    labels = scales::percent_format(),
    breaks = c(0.05, 0.1, 0.15, 0.2, 0.25)
  ) +
  theme_minimal() +
  labs(y = "Hybrid OA Uptake", x = NULL) +
  theme(
    legend.position = "top",
    legend.justification = "left",
    axis.text.x = element_blank()
  )

subject_ta_trend_plot <- top_level_by_year_oa |>
  filter(top_level != "Multidisciplinary") |>
  filter(!cr_year %in%  c("2017", "2023")) |>
  mutate(prop = ta_oa_frac / oa_frac) |>
  ggplot(aes(gsub("^20", "'", as.character(cr_year)), prop)) +
  geom_bar(stat = "identity", fill = "#56B4E9", color = "#000000",
            linewidth = 0.15) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)), breaks = c(0, 0.25,0.5,0.75), limits = c(0, .75),
                     labels = scales::percent) +
  facet_wrap(~top_level, nrow = 1) +
  theme_minimal() +
  labs(y = "Percentage\nof Hybrid OA\nvia Agreement", x = NULL) +
  theme(
    axis.text.x = element_blank(),
    strip.background = element_blank(),
    strip.text.x = element_blank())
subject_box_trend <- subject_df |>
   # with at least one
  select(-ajcs, -subject_area, -esac_publisher) |>
  distinct(cr_year, issn_l, top_level, .keep_all = TRUE) |>
  pivot_longer(cols = c(ta_oa, no_ta), names_to = "type", values_to = "value") |>
  filter(value > 0) |>
  filter(top_level != "Multidisciplinary", !cr_year %in% c("2017", "2023")) |>
  ggplot(aes(gsub("^20", "'", as.character(cr_year)), value / jn_all, fill = type)) +
  geom_boxplot(outlier.shape = NA, show.legend = FALSE, varwidth = TRUE) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)),
                     labels = scales::percent) +
  scale_fill_manual("Hybrid OA", values = c(no_ta = "#b3b3b3a0", ta_oa = "#56B4E9"), labels = c(no_ta = "Other", ta_oa = "Agreement")) +
  coord_cartesian(ylim = c(0,0.55)) +
  facet_wrap(~top_level, nrow = 1) +
  labs(y = "OA Uptake\nby Hybrid Journal", x = "Publication Year") +
  theme_minimal() +
    theme(strip.background = element_blank(),
    strip.text.x = element_blank()
    )
```

Figure \ref{fig:subject_panel} presents the relative growth of hybrid open access by subject area between 2018 and 2022. In particular, Social Sciences including Arts and Humanities journals accounted for the strongest growth in the five-years period from `r subject_trend_plot$data |> filter(cr_year == "2018", top_level == "Social Sciences") |> pull(prop) |> sum() * 100`% (n = `r subject_trend_plot$data |> filter(cr_year == "2018", top_level == "Social Sciences") |> pull(value) |> sum()`) to `r subject_trend_plot$data |> filter(cr_year == "2022", top_level == "Social Sciences") |> pull(prop) |> sum() *100`% (n = `r subject_trend_plot$data |> filter(cr_year == "2022", top_level == "Social Sciences") |> pull(value) |> sum()`), followed by the Life Sciences from `r subject_trend_plot$data |> filter(cr_year == "2018", top_level == "Life Sciences") |> pull(prop) |> sum() * 100`% (n = `r subject_trend_plot$data |> filter(cr_year == "2018", top_level == "Life Sciences") |> pull(value) |> sum()`) to `r subject_trend_plot$data |> filter(cr_year == "2022", top_level == "Life Sciences") |> pull(prop) |> sum() *100`% (n = `r subject_trend_plot$data |> filter(cr_year == "2022", top_level == "Life Sciences") |> pull(value) |> sum()`) , Health Sciences from `r subject_trend_plot$data |> filter(cr_year == "2018", top_level == "Health Sciences") |> pull(prop) |> sum() * 100`% (n = `r subject_trend_plot$data |> filter(cr_year == "2018", top_level == "Health Sciences") |> pull(value) |> sum()`) to `r subject_trend_plot$data |> filter(cr_year == "2022", top_level == "Health Sciences") |> pull(prop) |> sum() *100`% (n = `r subject_trend_plot$data |> filter(cr_year == "2022", top_level == "Health Sciences") |> pull(value) |> sum()`) and Physical Sciences from `r subject_trend_plot$data |> filter(cr_year == "2018", top_level == "Physical Sciences") |> pull(prop) |> sum() * 100`% (n = `r subject_trend_plot$data |> filter(cr_year == "2018", top_level == "Physical Sciences") |> pull(value) |> sum()`) to `r subject_trend_plot$data |> filter(cr_year == "2022", top_level == "Physical Sciences") |> pull(prop) |> sum() *100`% (n = `r subject_trend_plot$data |> filter(cr_year == "2022", top_level == "Physical Sciences") |> pull(value) |> sum()`). 
<!-- In particular, journals in the subject areas recorded large high rate (see supplement)-->
Growth in Social Sciences category can be largely attributed to transformative agreements. 
In 2022, two-thirds of open access articles (`r subject_ta_trend_plot$data |> filter(cr_year == "2022", top_level == "Social Sciences") |> pull(prop) * 100`%, n = `r subject_ta_trend_plot$data |> filter(cr_year == "2022", top_level == "Social Sciences") |> pull(ta_oa_frac)`) were published by the first authors affiliated with participating institutions (see \ref{fig:subject_panel}B). 


```{r subject_panel, fig.asp=0.8, fig.cap="Development of open access in hybrid journals in transformative agreements between 2018 and 2022 by ASJC subject area. The blue areas represent open access through transformative agreements, the grey areas depict open access articles where no link to an agreement could be established. (A) Proportion of open access articles in hybrid journals per year and subject area. (B) Percentage of hybrid open access via agreements per year and subject area. (C) Boxplots show individual open access uptake rates by individual hybrid journals and open access funding per publication year and subject area. The individual outliers are not shown. Note that data on transformative agreements ending before June 2021 were not available for this study."}

design = "E
A
B
C"
wrap_plots(
  E = guide_area(),
  A = subject_trend_plot,
  B = subject_ta_trend_plot,
  C = subject_box_trend,
  design = design,
  guides = "collect",
  heights = c(0, 0.4, 0.3, 0.7)
) &
  theme(
    legend.position = "top",
    legend.justification = "right",
    legend.direction = "horizontal",
    panel.grid.minor = element_blank(),
    panel.border = element_rect(color = "grey50", fill = NA),
    axis.title=element_text(size = 10)) &
    plot_annotation(tag_levels = 'A') 
```


Figure \ref{fig:subject_panel}C shows that this trend was consistent across hybrid journals belonging to the ASJC Social Sciences category.
In 2022, 25% of Social Sciences journals provided open access to at least every fourth article exclusively through transformative agreements.
However, hybrid open access through transformative agreements played a comparably lesser role in Life Sciences and Health Sciences. 
In these two subject areas, only about half of the open access articles can be linked to these agreements, both overall and on a median average across journals.
In contrast, the majority of Physical Science journals show an increase of open access through transformative agreements compared to other options to publish open access in hybrid journals.

## Comparing countries

```{r coutnry_data_prep}
country_all <- hoaddata::jn_aff |>
  filter(issn_l %in% hoaddata::jn_ind$issn_l) |>
  filter(!cr_year %in% c(2017, 2023), issn_l != "0027-8424") |>
  # only with cc
  filter(issn_l %in% hoaddata::cc_articles$issn_l) |>
  distinct(issn_l, cr_year, country_code, articles_total) |>
  group_by(cr_year, country_code) |>
  summarise(all = sum(articles_total))

country_oa <- hoaddata::cc_articles |>
  filter(issn_l %in% hoaddata::jn_ind$issn_l) |>
  filter(!cr_year %in% c(2017, 2023), issn_l != "0027-8424") |>
  group_by(cr_year, country_code) |>
  summarise(oa = n_distinct(doi))

country_codes <- readr::read_csv(here::here("data", "ror_country_codes.csv"))
country_ta <-  ta_oa_inst |>
  filter(issn_l %in% hoaddata::jn_ind$issn_l) |>
  filter(ta_active == TRUE, !is.na(cc), issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  left_join(country_codes) |>
  group_by(cr_year, country_code) |>
  summarise(ta_oa = n_distinct(doi))

country_df <- country_all |>
  left_join(country_oa, by = c("cr_year", "country_code")) |>
  left_join(country_ta, by = c("cr_year", "country_code")) |>
  distinct() |>
  ungroup() |>
  mutate(cr_year = as.character(cr_year)) |>
  mutate(across(c(oa, ta_oa), .fns = ~replace_na(.,0))) |>
  filter(!is.na(country_code)) |>
  mutate(
    country_name = countrycode::countrycode(country_code, origin = "iso2c", destination = "country.name")
  )


# Top 20 in terms of articles published
top_20 <- country_df |>
  filter(!is.na(country_code)) |>
  group_by(country_code, country_name) |>
  summarise(n = sum(all)) |>
  arrange(desc(n)) |>
  head(20) 

## Order of multiples, sort by the most productive (Top 20)

country_multiple_df <- country_df |>
  mutate(country_name_fct = forcats::fct_other(country_code, keep = top_20$country_code)) |>
  mutate(country_name_fct = forcats::fct_relevel(country_name_fct, top_20$country_code, "Other")) |>
  group_by(country_name_fct, cr_year) |>
  summarise(
    all_total = sum(all),
    oa_total = sum(oa),
    ta_oa_total = sum(ta_oa)
  ) |>
  mutate(prop = oa_total / all_total) |>
  # remove cases where we could not retrieve a country name |>
  filter(!is.na(country_name_fct))

# Prepare facet heading
facet_labels <- country_multiple_df |>
  group_by(country_name_fct) |>
  summarise(total = sum(all_total)) |>
  mutate(prop = total / sum(total)) |>
  ungroup() |>
  mutate(total_string = case_when(
    total < 1000 ~ as.character(total),
    total < 1000000 ~ paste0(format(round(total / 1e3, 1), trim = TRUE), "K"),
    total >= 1000000 ~ paste0(format(round(total / 1e6, 2), trim = TRUE), "M")
  )) |>
  mutate(
    facet_labels = glue::glue(
      '{country_name_fct}<br>
      {total_string} | {paste0(round(prop * 100, 1), "%")}'
    )
  ) |>
  distinct(country_name_fct, facet_labels)

country_facet_labels <- as.character(facet_labels$facet_labels)
names(country_facet_labels) <- facet_labels$country_name_fct

top_20_plot_df <- 
  country_multiple_df |> 
  mutate(no_ta = oa_total - ta_oa_total) |>
  rename(ta_oa = ta_oa_total) |>
  pivot_longer(
  cols = c(no_ta, ta_oa),
  values_to = "value",
  names_to = "type") 
```

```{r, country_plot, fig.asp=0.8}
country_plot <- ggplot(top_20_plot_df, aes(
    gsub("^20", "'", as.character(cr_year)),
    value / all_total,
    group = type,
    fill = type
  )) +
  geom_area(color = "#000000",
            linewidth = 0.15,
            stat = "identity") +
scale_fill_manual(
    NULL,
    values = c(no_ta = "#b3b3b3a0", ta_oa = "#56B4E9"),
    labels = c(no_ta = "Other", ta_oa = "Agreement"),
    guide = guide_legend(reverse = TRUE)
  ) +
  facet_wrap( ~ country_name_fct,
              nrow = 3,
              labeller = as_labeller(country_facet_labels)) +
  scale_y_continuous(
    labels = scales::percent_format(accuracy = 1L),
    expand = expansion(mult = c(0, 0.05)),
    breaks = scales::breaks_extended(4)
  ) +
  theme_minimal() +
  labs(y = "Hybrid OA Uptake", x = "2018 - 2022") +
  theme(
    legend.position = "top",
    legend.justification = "right",
    legend.direction = "horizontal",
    axis.text.x = element_blank(),
    panel.grid.minor = element_blank(),
                panel.border = element_rect(color = "grey50", fill = NA),
    axis.title=element_text(size = 10),
    strip.text = ggtext::element_markdown(size = 6),
    plot.subtitle = ggtext::element_markdown(hjust = 0.5),
    panel.spacing = unit(1, "lines")
  )
```

```{r}
oecd <- readr::read_csv(here::here("data", "oecd.csv")) |>
  mutate(country_code = countrycode::countrycode(iso3, "iso3c", "iso2c"))


country_scatter_df <- country_df |>
#  filter(cr_year == "2022", !is.na(country_code)) |>
  mutate(cat = case_when(
    country_code %in% oecd$country_code ~ "OECD",
    country_code %in% c("BR", "CN", "IN", "RU", "ZA") ~ "BRICS",
    .default = "Other"
  ))

oecd_stats <- readr::read_csv(here::here("data", "oecd_stats.csv"))
oecd_stats_global <- oecd_stats |> 
  filter(issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  filter(issn_l %in% hoaddata::cc_articles$issn_l) |>
  group_by(cat) |> summarise(articles = sum(articles), oa = sum(oa), ta_oa = sum(ta_oa))
```

```{r country_bar_chart_top_20}
top_20_df <- country_scatter_df |>
  filter(cr_year == "2022") |>
  mutate(country_name_fct = forcats::fct_other(country_name, keep = top_20$country_name)) |>
  mutate(country_name_fct = forcats::fct_relevel(country_name_fct, top_20$country_name, "Other")) |>
  group_by(country_name_fct, country_code, cat) |>
  summarise(all = sum(all),
            oa = sum(oa),
            ta_oa = sum(ta_oa), .groups = "drop") |>
  head(20) |>
  mutate(cat_labels = case_when(
   cat == "OECD" ~ glue::glue("<span style = 'color: #3fc1c9'>{country_code}</span>"),
   cat == "BRICS" ~ glue::glue("<span style = 'color: #fc5185'>{country_code}</span>"),
   cat == "Other" ~ glue::glue("<span style = 'color: #e1e1e1'>{country_code}</span>")
  )) |>
  mutate(cat_labels = fct_inorder(cat_labels))


top_20_plot <- top_20_df |>
  mutate(no_ta = oa - ta_oa) |>
  pivot_longer(
  cols = c(no_ta, ta_oa),
  values_to = "value",
  names_to = "type") |>
  ggplot(aes(reorder(as.character(country_code),  value), value / sum(value), fill = type)) +
    geom_bar(stat = "identity", color = "#000000", linewidth = 0.15) +
   scale_fill_manual(
    NULL,
    values = c(no_ta = "#b3b3b3a0", ta_oa = "#56B4E9"),
    labels = c(no_ta = "Other", ta_oa = "Agreement"),
    guide = FALSE) +
  coord_flip() +
  scale_y_continuous(
    labels = scales::percent_format(accuracy = 1L),
    expand = expansion(mult = c(0, 0.05)),
    breaks = scales::breaks_extended(4)
  ) +
  theme_minimal() +
#  theme(axis.text.y = ggtext::element_markdown()) +
  labs(x = NULL, y = "% of Hybrid OA published\nin 2022")

```

```{r}
country_scatter_22 <- country_scatter_df |>
  filter(cr_year == "2022", !is.na(country_code), all > 5000) |>
  ggplot(aes(all, oa / all)) +
  geom_point(aes(fill = cat), pch = 21, alpha = 0.7) +
  scale_fill_manual(NULL, values = c("OECD" = "#d01c8b", "BRICS" = "#4dac26", "Other" = "#f7f7f7")) +
  geom_smooth(aes(all, oa / all), method = "lm", se = TRUE) +
  scale_size("Agreement", guide = FALSE) +
  ggrepel::geom_text_repel(
    data = filter(country_scatter_df, cr_year == 2022, ta_oa > 2000 | country_code %in% c("CN", "IN", "BR", "RU", "IR")),
    aes(x = all, y = oa / all, label = country_code),
            min.segment.length = .15,
    force = 5,
    segment.color = "grey10",
    segment.size = 0.5,
    segment.alpha = 0.8,
    color = "grey10", 
    size = 3,
    box.padding = 0.3) +
  scale_y_continuous(labels =  scales::percent) +
  scale_x_log10(labels =  scales::number_format(big.mark = ",")) +
  theme_minimal() +
  labs(x = "Total Articles in Hybrid Journals in 2022\n(log-scale)", y = "OA Uptake") 

oecd_stats <- readr::read_csv(here::here("data", "oecd_stats.csv"))

oecd_by_year <- oecd_stats |>
  filter(issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  filter(issn_l %in% hoaddata::cc_articles$issn_l) |>
  group_by(cr_year) |>
  summarise(yearly_volume = sum(articles, na.rm = TRUE))

oecd_stats_df <- oecd_stats |>
  filter(issn_l != "0027-8424", !cr_year %in%  c("2017", "2023")) |>
  filter(issn_l %in% hoaddata::cc_articles$issn_l) |>
  group_by(cr_year, cat) |>
  summarise(all = sum(articles, na.rm = TRUE), oa = sum(oa,na.rm = TRUE), ta_oa = sum(ta_oa, na.rm = TRUE)) |>
  mutate(closed = all - oa,
         oa_other = oa - ta_oa) |>
  pivot_longer(cols = c(ta_oa, oa_other, closed), names_to = "oa_type") |>
  mutate(cat = ifelse(is.na(cat), "Other", cat)) |>
  left_join(oecd_by_year, by = "cr_year")

country_bar <- ggplot(oecd_stats_df,
                      aes(
                        gsub("^20", "'", as.character(cr_year)),
                        value / yearly_volume,
                        group = oa_type,
                        fill = oa_type
                      )) +
  geom_area(color = "#000000", linewidth = 0.15) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)), labels = scales::percent_format()) +
  facet_wrap( ~ cat) +
  scale_fill_manual(
    NULL,
    values = c(
      oa_other = "#b3b3b3a0",
      ta_oa = "#56B4E9",
      closed = "#e1e1e1a0"
    ),
    labels = c(
      oa_other = "Other",
      ta_oa = "Agreement",
      closed = "Closed"
    ),
    guide = guide_legend(reverse = TRUE)
  ) +
  theme_minimal() +
  labs(x = "Publication Year", y = "% of Total Articles\nin Hybrid Journals")
```

```{r country_by_publisher}
publisher_mapping <-  hoaddata::jct_hybrid_jns |>
  distinct(issn_l, esac_publisher) 
subject_mapping <- subject_df |>
  distinct(issn_l, top_level)
country_jn_all <- oecd_stats |>
  filter(!cr_year %in% c(2017, 2023), issn_l != "0027-8424") |>
  # only with cc
  filter(issn_l %in% hoaddata::cc_articles$issn_l) |>
  inner_join(publisher_mapping, by = "issn_l") |>
  inner_join(subject_mapping, by = "issn_l") |>
  # Publisher encoding
   mutate(
    publisher = case_when(
      esac_publisher == "Elsevier" ~ "Elsevier",
      esac_publisher == "Springer Nature" ~ "Springer Nature",
      esac_publisher == "Wiley" ~ "Wiley",
      is.character(esac_publisher) ~ "Other"
    )
  ) |>
  mutate(publisher =
           forcats::fct_relevel(
             publisher,
             c("Elsevier", "Springer Nature", "Wiley", "Other") 
           ))  |> 
  group_by(cr_year, publisher, cat, top_level) |>
  summarise(all = sum(articles),
            oa = sum(oa),
            ta_oa = sum(ta_oa), .groups = "drop") |>
  mutate(closed = all - oa,
         oa_other = oa - ta_oa) 

publ_subject_output_df <- country_jn_all |>
  distinct(cr_year, publisher, top_level, cat, all) |>
  filter(!top_level %in% c("Multidisciplinary", NA))
 
pub_subject_output_plot <-  ggplot(publ_subject_output_df, aes(gsub("^20", "'", as.character(cr_year)), all, fill = cat)) +
  geom_bar(stat = "identity", position = position_dodge2(preserve = "single")) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)), labels =  scales::number_format(big.mark = ",")) +
  scale_fill_manual(NULL, values = c("OECD" = "#d01c8b", "BRICS" = "#4dac26", "Other" = "#f7f7f7")) +
  facet_grid(publisher ~ top_level) +
  theme_minimal() +
  labs(x = "Publication Year", y = "Total Articles")

subject_output_plot <- publ_subject_output_df |>
  group_by(cr_year, top_level, publisher) |>
  summarise(all = sum(all)) |>
  ggplot(aes(cr_year, all)) +
  geom_bar(stat = "identity") +
  facet_grid(top_level ~ publisher) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)), labels =  scales::number_format(big.mark = ",")) +
   theme_minimal() +
  labs(x = "Publication Year", y = "Hybrid OA Uptake")

publisher_output_plot <-
  publ_subject_output_df |>
  group_by(cr_year, cat, publisher) |>
  summarise(all = sum(all)) |>
  ggplot(aes(cr_year, all)) +
  geom_bar(stat = "identity") +
  facet_grid(cat ~ publisher) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)), labels =  scales::number_format(big.mark = ",")) +
   theme_minimal() +
  labs(x = "Publication Year", y = "Total Articles")
```

Between 2018 and 2022, high-income countries almost exclusively dominated hybrid open access publishing through transformative agreements. 
To discern socio-economic differences, these countries were grouped according to their membership in the Organisation for Economic Co-operation and Development (OECD).
Overall, first authors affiliated with institutions from OECD member countries published `r oecd_stats_global |> filter(cat == "OECD") |> pull(oa)` open access articles in hybrid journals, representing `r oecd_stats_global |> filter(cat == "OECD") |> pull(oa) / n_oa * 100`% of the investigated open access articles.
This disparity between OECD nations and other countries becomes even more evident when considering open access through transformative agreements, as  `r oecd_stats_global |> filter(cat == "OECD") |> pull(ta_oa)` of `r n_ta_oa`, or `r oecd_stats_global |> filter(cat == "OECD") |> pull(ta_oa) / n_ta_oa*100`% of open access articles were associated with such agreements.

```{r country_patch, fig.asp=0.9, fig.cap="Development of hybrid open access publishing by country. (A) presents the relative number of articles published in hybrid journals included in transformative agreement by year, distinguishing between BRICS as of 2022, OECD and other countries. (B) Scatterplot contrasts total articles with open access article volume in 2022, by country and its OECD (purple-colored points) or BRICS (green) membership. Trend line obtained from linear regression, grey area show pointwise symmetric 95% confidence bands. (C) Hybrid open access market share in 2022 by country. In (A) and (C), the blue areas represent open access through transformative agreements, the grey areas depict open access articles where no link to an agreement could be established. The remainder shows closed access articles. Country names are represented as ISO two-letter country codes."}

wrap_plots(
  A = country_bar,
  B = country_scatter_22,
  C = top_20_plot,
  design = "
  AC
  BC",
  widths = c(0.7, 0.3),
  heights = c(0.5,0.5)
) &
  theme(
    panel.grid.minor = element_blank(),
    panel.border = element_rect(color = "grey50", fill = NA),
    axis.title=element_text(size = 10),
    legend.position = "top", 
    legend.justification = "right") &
    plot_annotation(tag_levels = 'A') 
```

Figure \ref{fig:country_patch}A shows the development of hybrid open access publishing by country, comparing the OECD area with the BRICS, an intergovernmental organisation, which comprised  Brazil, Russia, India, China, and South Africa as of 2022. 
The residual category "Other" includes the remaining countries. 
Full counting was applied to account for multiple country affiliations [@Hottenrott_2021].
Open access in hybrid journals increased in particular because of publications from first authors affiliated with institutions from the OECD area, from `r country_bar$data |> filter(cat == "OECD", oa_type != "closed", cr_year == 2018) |> pull(value) |> sum()` in 2018 to `r country_bar$data |> filter(cat == "OECD", oa_type != "closed", cr_year == 2022) |> pull(value) |> sum()` in 2022. 
This growth was largely driven by transformative agreements. 
Their share rose from `r country_bar$data |> filter(cat == "OECD", oa_type != "closed", cr_year == 2018, oa_type == "ta_oa") |> pull(value) / country_bar$data |> filter(cat == "OECD", oa_type != "closed", cr_year == 2018, oa_type == "ta_oa") |> pull(oa) * 100`% in 2018 (n = `r country_bar$data |> filter(cat == "OECD", oa_type != "closed", cr_year == 2018, oa_type == "ta_oa") |> pull(value)`) to `r country_bar$data |> filter(cat == "OECD", oa_type != "closed", cr_year == 2022, oa_type == "ta_oa") |> pull(value) / country_bar$data |> filter(cat == "OECD", oa_type != "closed", cr_year == 2022, oa_type == "ta_oa") |> pull(oa) * 100`% (n = `r country_bar$data |> filter(cat == "OECD", oa_type != "closed", cr_year == 2022, oa_type == "ta_oa") |> pull(value)`) in 2022.
In contrast, BRICS recorded a low uptake, moderately growing from `r country_bar$data |> filter(cat == "BRICS", oa_type != "closed", cr_year == 2018) |> mutate(prop = value / all) |> pull(prop) |> sum() * 100`% in 2018 to `r country_bar$data |> filter(cat == "BRICS", oa_type != "closed", cr_year == 2022) |> mutate(prop = value / all) |> pull(prop) |> sum() * 100`% in 2022.  

Despite the rise of open access across OECD countries, the overall publication output decreased sharply, dropping to `r country_bar$data |> filter(cat == "OECD", cr_year == "2022") |> distinct(all) |> pull(all)` in 2022 after peaking `r country_bar$data |> filter(cat == "OECD", cr_year == "2020") |> distinct(all) |> pull(all)` articles in 2020, which saw a massive growth in literature related to COVID-19, driven largely by researchers in the United States surpassing China and other countries [@Ioannidis_2021].
In stark contrast, the number of articles published in hybrid journals by first authors affiliated with institutions from BRICS countries increased steadily over the years, from `r country_bar$data |> filter(cat == "BRICS", cr_year == "2018") |> distinct(all) |> pull(all)` in 2018 to `r country_bar$data |> filter(cat == "BRICS", cr_year == "2022") |> distinct(all) |> pull(all)` in 2022. 
This resulted in an increase in market share of the BRICS area from `r country_bar$data |> filter(cat == "BRICS", cr_year == "2018") |> distinct(all, yearly_volume) |> mutate(prop = all /yearly_volume) |> pull(prop) * 100`% to `r country_bar$data |> filter(cat == "BRICS", cr_year == "2022") |> distinct(all, yearly_volume) |> mutate(prop = all /yearly_volume) |> pull(prop) * 100`% between 2018 and 2022, whereas that of the OECD area decreased from `r country_bar$data |> filter(cat == "OECD", cr_year == "2018") |> distinct(all, yearly_volume) |> mutate(prop = all /yearly_volume) |> pull(prop) * 100`% to `r country_bar$data |> filter(cat == "OECD", cr_year == "2022") |> distinct(all, yearly_volume) |> mutate(prop = all /yearly_volume) |> pull(prop) * 100`% during the same period.
Upon closer examination, this trend can be observed across all of the three largest publishers, although the shift towards BRICS is particularly evident in Elsevier's hybrid journal portfolio, particularly with regard to articles published in Physical Sciences journals. 
While OECD publication output in Elsevier's Physical Sciences journals declined from `r publ_subject_output_df |> filter(cr_year == 2018, top_level == "Physical Sciences", publisher == "Elsevier", cat == "OECD") |> pull(all)` articles in 2018 to `r publ_subject_output_df |> filter(cr_year == 2022, top_level == "Physical Sciences", publisher == "Elsevier", cat == "OECD") |> pull(all)` in 2022, BRICS output increased from `r publ_subject_output_df |> filter(cr_year == 2018, top_level == "Physical Sciences", publisher == "Elsevier", cat == "BRICS") |> pull(all)` to `r publ_subject_output_df |> filter(cr_year == 2022, top_level == "Physical Sciences", publisher == "Elsevier", cat == "BRICS") |> pull(all)` in the same five-year period.
Furthermore, OECD publication output in Health Sciences and Life Sciences journals stagnated after peaking in 2020, which saw an increase in publications due to the impact of the global COVID-19 pandemic, in particular from the United States [@Ioannidis_2021]. 

To illustrate the situation in 2022, Figure \ref{fig:country_patch}B compares the total publication output with the number of open access articles. 
With `r country_scatter_df |> filter(cr_year == "2022", country_code == "CN") |> pull(all)` articles, China was the most productive country, followed by the United States (n = `r country_scatter_df |> filter(cr_year == "2022", country_code == "US") |> pull(all)`) and India (n = `r country_scatter_df |> filter(cr_year == "2022", country_code == "IN") |> pull(all)`). 
In contrast, Western and Northern European countries published a considerably high number of open access articles. 
Particularly, Nordic countries, the Netherlands and Austria recorded above-average open access shares, as indicated by the linear trend line.
As shown in Figure \ref{fig:country_patch}C, transformative agreements contributed to these market positions. 
Interestingly, the United States had a notable open access market share of `r top_20_plot$data |> distinct(country_code, oa, all) |> mutate(prop = oa / sum(oa)) |> filter(country_code == "US") |> pull(prop) * 100`%, although transformative agreements contributed to a lesser extent. Similarly, China's open access market share of `r top_20_plot$data |> distinct(country_code, oa, all) |> mutate(prop = oa / sum(oa)) |> filter(country_code == "CN") |> pull(prop) * 100`% in 2022 was comparable to that of the Netherlands, which was `r  top_20_plot$data |> distinct(country_code, oa, all) |> mutate(prop = oa / sum(oa)) |> filter(country_code == "NL") |> pull(prop) * 100`%.


```{r country_top_20_plot, fig.asp=0.8, fig.cap="Development of open access in hybrid journals in transformative agreements between 2018 and 2022, by the Top 20 most productive countries in terms of total articles published in the five-years period. Blue areas represent open access through transformative agreements, the grey areas depict open access articles where no link to an agreement could be established. Country names are represented as ISO two-letter country codes. Facet subheadings show the total number of articles and corresponding market share."}
country_plot
```

Figure \ref{fig:country_top_20_plot} illustrates the development of hybrid open access from 2018 to 2022, highlighting the top 20 most productive countries in terms of articles published in hybrid journals that were included in transformative agreements over the five-year period. 
Notably, the Netherlands (`r country_plot$data |> filter(cr_year == "2018", country_name_fct == "NL") |> distinct(all_total, oa_total) |> mutate(prop = oa_total / all_total) |> pull(prop)*100`%), Sweden (`r country_plot$data |> filter(cr_year == "2018", country_name_fct == "SE") |> distinct(all_total, oa_total) |> mutate(prop = oa_total / all_total) |> pull(prop)*100`%), Poland (`r country_plot$data |> filter(cr_year == "2018", country_name_fct == "PL") |> distinct(all_total, oa_total) |> mutate(prop = oa_total / all_total) |> pull(prop)*100`%) and Great Britain (`r country_plot$data |> filter(cr_year == "2018", country_name_fct == "GB") |> distinct(all_total, oa_total) |> mutate(prop = oa_total / all_total) |> pull(prop)*100`%) exhibited a relatively high level of uptake in 2018 which continued to increase in the following years. 
In 2022, Sweden had the highest proportion of open access relative to its publication output (`r country_plot$data |> filter(cr_year == "2022", country_name_fct == "SE") |> distinct(all_total, oa_total) |> mutate(prop = oa_total / all_total) |> pull(prop)*100`%), followed by the Netherlands (`r country_plot$data |> filter(cr_year == "2022", country_name_fct == "NL") |> distinct(all_total, oa_total) |> mutate(prop = oa_total / all_total) |> pull(prop)*100`%) and Switzerland (`r country_plot$data |> filter(cr_year == "2022", country_name_fct == "CH") |> distinct(all_total, oa_total) |> mutate(prop = oa_total / all_total) |> pull(prop)*100`%), with these countries benefiting from transformative agreements.
In Germany, however, hybrid open access only began to increase from 2019 onwards after the successful negotiation of nationwide agreements with Wiley (July 2019) and Springer Nature (January 2020). Prior to this, only a few organisations had agreements in place, for example, the Max Planck Society with Springer Compact.

Since 2021, there has been a general trend towards hybrid open access among many high-income countries, driven primarily by transformative agreements.
However, the proliferation of transformative agreements differed across these countries.
<!-- For instance, Germany successfully negotiated an agreement with Elsevier not until 2023. -->
Additionally, publication limits or eligibility criteria for institutions and article types may explain why even countries with widespread agreement implementation such as Sweden or the Netherlands did not achieve 100% hybrid open access. 
Interestingly, in Japan and the United States, options other than transformative agreements were the main drivers for the increase in hybrid open access.
Once again, the graph highlights countries with low hybrid open access, particularly non-OECD countries, where only a few or no agreements were in place.

<!--
# Supplements

```{r}
#pub_subject_output_plot
```

-->
# Discussion

The primary aim of this study was to assess the uptake of open access in hybrid journals included in transformative agreements, which were introduced as a temporal means to support the transition of subscription-based academic publishing to full open access.
This study presents a novel approach based on open data, which leverages metadata on over 700 agreements and nine million journal articles to estimate the extent to which transformation agreements contribute to the transition of this journal business model.
The results highlight a strong growth in open access between 2018 and 2022, driven by an increasing number transformative agreements. 
However, the majority of research literature published in hybrid journals in this five-year period remained behind publisher paywalls.
Growth in the adoption of open access in hybrid journals, in particular through transformative agreements, can be largely attributed to three large commercial publishers -- Elsevier, Springer Nature, and Wiley -- but varies substantially across journals, publishers, disciplines, and country affiliations. 
Despite the limitations of the data, the findings indicate that the current level of implementation of transformative agreements is insufficient to bring about a large-scale transition to full open access.

A key finding of this analysis is that transformative agreements maintain market concentration. 
Specifically, the three largest commercial publishers Elsevier, Springer Nature, and Wiley dominate, particularly with regard to open access provided through transformative agreements.
Together, the three publishers accounted for three-fourths of open access articles through transformative agreements, while recording about half of active hybrid journals included in transformative agreements between 2018 and 2022.
This observation aligns with previous research on shifts in the publishing market following the introduction of funding opportunities for hybrid open access [@Jahn_2016; @Butler_2023; @Shu_2023]. 
Additionally, the results confirm previously observed variations by publisher, with Elsevier exhibiting a different development than Springer Nature and Wiley  [@Butler_2023; @Jahn_2021]. 
However, it must be noted that the focus of transformative agreements on publishers with large hybrid journal portfolios is intentional [@ifla].
Because of transformative agreements with a few large publishers, national consortia were able to substantially increase their country’s annual open access article volume [@Jisc_2024; @Bosman_2021; @Pinhasi_2021; @Huang_2020; @Taubert_2023; @Wenaas_2022; @Widding_2024]. 

Moreover, this study presents varying levels of open access uptake through transformative agreements across journals, which can be attributed to the alignment of authors' affiliations and the availability of such agreements at their institutions.
In line with previous research findings [@Butler_2023; @Jahn_2021; @Wenaas_2022], high uptake rates were observed across Social Sciences and Humanities hybrid journals.
However, it is important to emphasise that these hybrid journals do not encompass the entire field.
For example, @Khanna_2022 found that approximately 60% of journals utilising the open-source publishing platform Open Journal Systems (OJS) fall within the Social Sciences and Humanities. 
In these fields, the majority of full open access journals are so-called "Diamond OA journals", which do not charge publication fees [@bosman_2021_4558704].
Rather, this result can be more accurately attributed to the substantial proportion of authors from high-income countries who publish in these hybrid journals included in transformative agreements, particularly when journals are of local relevance, such as by belonging to national societies or regional research scope.
 <!--   [funding options in the humanities and social sicences] -->

Surprisingly, the total publication output of high-income countries belonging to the OECD in hybrid journals declined substantially after peaking in 2020, whereas that of BRICS countries continuously grew from 2018 to 2022.
Because the BRICS expansion can be exclusively attributed to closed access articles, this development has the potential to hinder the transition of academic journal publishing to full open access through transformative agreements and demands discussion. 
In China, the country with the highest volume of articles in hybrid journals, only limited research funding to pay for open access is available, with expenditures for open access publishing surpassing subscription costs at some universities [@Shu_2023].
Furthermore, the focus of Chinese authors on established journals may contribute to this trend [@Zhang_2022]. 
Although China supports Plan S [@Schiermeier_2018], this is not reflected in the data in terms of open access uptake in hybrid journals.
Market observers also do not expect a broad implementation of transformative agreements in China in near future [@Owens_2024].
As highlighted by @Koley_2023, India faces similar challenges in terms of the availability of resources to pay for open access.
At the same time, access to research literature is a pressing issue, which is addressed by the "Indian one nation, one subscription" policy proposal. 
However, this policy focuses on centrally negotiated subscriptions and does not entail open access.

But open access uptake also differs among OECD countries. 
In the United States, for example, hybrid open access, including transformative agreements, plays a lesser role than in some European countries. 
Between 2017 and 2021, hybrid open access contributed the least to openly available federally funded research articles [@Schares_2023]. 
While some university consortia, such as the California Digital Library, have signed transformative agreements, others have attempted to depart from big deals and unbundle large journal portfolios to address cost increases [@Brainard_2021; @Schares_2022].
Despite the relatively low penetration of transformative agreements in China and the United States compared to Europe, 22% of open access in hybrid journals in 2022 originates from these two countries, indicating the availability of funding sources for publication fees.

This large-scale study provides the first empirical evidence of the influence of transformative agreements on the transition of hybrid journals to full open access. 
However, several limitations need to be acknowledged.
From a data perspective, estimations of open access through transformative agreements were established by linking author affiliations with publicly available agreement data from cOAlition S, and not through invoicing data, which is usually not shared.
Because data on corresponding authors, who are typically responsible for facilitating open access publication, were not fully supported by OpenAlex at the time of this study, first author affiliations were used instead.
This study is also unable to account for the various types of transformative agreements due to a lack of data, especially regarding article types and caps that limit the number of open access articles covered.
Furthermore, assessing the quality of the OpenAlex and Crossref data used, particularly in terms of affiliations, corresponding authorship, and article types, by combining them with established bibliometric databases such as Scopus and Web of Science was beyond the scope of this analysis [@Visser_2021; @Chinchilla_Rodr_guez_2024].
It must therefore be emphasised that, unlike evaluations from national consortia that could make use of invoices [@Jisc_2024], this global overview can only provide an estimate of the support for open access through transformative agreements.
Despite these limitations, the methodology was designed to underestimate, rather than overestimate, the adoption of open access through transformative agreements. 
To promote transparency, the data used in this study, along with the code used for this analysis, are openly available.

Additionally, it must be noted that the study period was significantly impacted by the COVID-19 pandemic, which led to an unprecedented number of publications and a reduction in international collaboration [@Aviv_Reuven_2021], which could explain the observed contrasting developments in OECD and BRICS countries. 
However, even before the pandemic, growth in publications in Europe was only due to internationally co-authored journal articles [@Kwiek_2020]. 
Likewise, inflows from China to the United States and European countries already declined by 2020 [@Zhao_2023].
Furthermore, the study design did not consider emerging publication practices such as preprints [@Fraser_2021] and special issues [@hanson2023strain], which have grown rapidly since 2020. 
Lastly, it should be emphasised that the study did not address financial shifts between subscriptions spending and open access payments while analysing hybrid open access through transformative agreements due to a lack of data on expenditures.

This study allows for multiple strands of further research. 
One is to complement this large-scale study with more specific evidence from individual countries or subjects, particularly those with low hybrid open access rates.
Incorporating full open access and subscription-based journals, as well as considering global trends in scholarly migration and collaboration could also be promising.
Financial studies could build on the study design and include subscription and open access expenditure to assess the cost-effectiveness of transformative agreements, in particular whether transformative agreements can integrate the substantial amounts of individual payments for publication fees [@Wenaas_2022; @Butler_2023], as well as potential changes in authors' behaviour following the introduction of these agreements [@Schmal_2024].

This study has practical implications for research funding and libraries.
One concern should be the observed differences across countries, particularly the relationship between socio-economic development and open access adoption.
Between 2018 and 2022, there was a notable increase in the number of closed access articles published in hybrid journals by authors from countries such as China and India, where transformative agreements and open access funding options were not widely available.
In contrast, the introduction of country-wide transformative agreements in numerous OECD countries led to a substantial increase in open access, while their share of total articles in hybrid journals decreased.
This imbalance, whereby open access uptake depends largely on a few countries, makes it less likely that collective action towards a large-scale transition of hybrid journals to full open access through transformation agreements will succeed within the next years.
Rather, and in accordance with recent British and Scandinavian policy recommendations [@Jisc_2024; @Widding_2024], it emphasises the importance of ongoing evaluation and adaptation of open access strategies in view of global publishing trends and related challenges to equity and journal quality [@Ross_Hellauer_2022; @Goodin_2023]. 

From a data perspective, research institutions and funders need to push towards price transparency in scholarly publishing to enable these evaluations. 
The reporting of open access funding, including transformative agreements, is also not harmonised, but often crowd-sourced from various sources.
To improve the assessment of transformative agreements, libraries and publishers should collaborate on standards and services to publicly share information about respective journal portfolios, participating institutions and open access invoicing, for example in the international context of ESAC and the Barcelona Declaration on Open Research Information.
Such collaboration would help overcome the limitations of current approaches that derive funding for open access from authorship data. 

In summary, this study provides empirical insights into the development of hybrid open access following the introduction of transformative agreements. 
These results are important for both researchers and stakeholders engaged in negotiating and evaluating these agreements. 
The presented approach relies on open data, which enables follow-up studies and open access monitoring activities to further explore the role of transformative agreements in transitioning academic publishing to full open access.

# Competing interests

The author declares no competing interests. 

# Funding information

This work was supported by the Deutsche Forschungsgemeinschaft (Grant number 416115939). 

# Data and code availability

Source code analysis including data used is available on GitHub: <https://github.com/njahn82/hoa_ta_effects>.

# References 

[^springercompact]: <https://web.archive.org/web/20180414062853id_/http://www.liber2015.org.uk/wp-content/uploads/2015/03/Springer-Compact.pdf> 

[^tadump]: <https://journalcheckertool.org/transformative-agreements/>

[^esacregistry]: <https://esac-initiative.org/about/transformative-agreements/agreement-registry/>

[^esacmarketwatch]: <https://esac-initiative.org/market-watch/>

[^doaj]: <https://doaj.org/csv>

[^checkertool]: <https://www.coalition-s.org/blog/enabling-accurate-results-within-the-journal-checker-tool/>

[^coalitions]: <https://www.coalition-s.org/coalition-s-confirms-the-end-of-its-financial-support-for-open-access-publishing-under-transformative-arrangements-after-2024/>


[^agreements]: In this paper I use the term "transformative agreement", addressing also offsetting, read-and-publish or publish-and-read deals, and other variants [@Borrego_2020; @Hinchliffe_2019]. Although the term is critised as misleading and not useful to describe the different types of open access agreements between library consortia and commercial publishers [@budapest], it is widely used in policy discussions and in the research literature.
